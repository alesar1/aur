#! /bin/bash
#  (GPL3+) Alberto Salvia Novella (es20490446e.wordpress.com)


mainFunction () {
	summary=$(summary "${1}")

	updateInfoFile
	publish "${summary}"
}


changeToThisProgramDir () {
	cd "$( dirname "${BASH_SOURCE[0]}" )"
}


publish () {
	summary="${1}"

	silently "publish: add" "git add ."
	git commit --message="${summary}" 2>&1 >"/dev/null"
	silently "publish: push" "git push"
}


silently () {
	function="${1}"
	command="${2}"
	error=$(eval "${command}" 2>&1 >"/dev/null")

	if [ ${?} -ne 0 ]; then
		echo "${function}: ${error}" >&2
		exit 1
	fi
}


summary () {
	summary="${1}"

    if [ "${summary}" == "" ]; then
        echo $(date "+%Y-%m-%d %s")
    fi
}


updateInfoFile () {
	silently "updateInfoFile" "makepkg --printsrcinfo > .SRCINFO"
}


changeToThisProgramDir
mainFunction ${@}
