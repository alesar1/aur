#! /bin/bash
#  (GPL3+) Alberto Salvia Novella (es20490446e.wordpress.com)


mainFunction () {
	message=$(message "${1}")

	updateInfoFile
	publish "${message}"
}


changeToThisProgramDir () {
	cd "$( dirname "${BASH_SOURCE[0]}" )"
}


echoOnError () {
	function="${1}"
	command="${2}"
    error=$(eval "${command}" 2>&1 >"/dev/null")

    if [ ${?} -ne 0 ]; then
        echo "${function}: ${error}" >&2
        exit 1
    fi
}


message () {
	message="${1}"

    if [ "${message}" == "" ]; then
        echo $(date "+%Y-%m-%d %s")
    fi
}


publish () {
	message="${1}"

	echoOnError "publish" "git add ."
	echoOnError "publish" "git commit --message=\"${message}\""
	echoOnError "publish" "git push"
}


updateInfoFile () {
	echoOnError "updateInfoFile" "makepkg --printsrcinfo > .SRCINFO"
}


changeToThisProgramDir
mainFunction ${@}
