From cff688b6aa4a034959eee3d4c3c54bd3810cc03a Mon Sep 17 00:00:00 2001
From: StMartin81 <martin.stolpe@gmail.com>
Date: Sat, 12 Aug 2017 01:14:10 +0200
Subject: [PATCH] Added support for kernel >= 4.11.9

---
 os_dep/linux/ioctl_cfg80211.c | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/os_dep/linux/ioctl_cfg80211.c b/os_dep/linux/ioctl_cfg80211.c
index 2fa84da..7d1ce83 100644
--- a/os_dep/linux/ioctl_cfg80211.c
+++ b/os_dep/linux/ioctl_cfg80211.c
@@ -3964,7 +3964,12 @@ static int rtw_cfg80211_add_monitor_if(_adapter *padapter, char *name, struct ne
 	mon_ndev->type = ARPHRD_IEEE80211_RADIOTAP;
 	strncpy(mon_ndev->name, name, IFNAMSIZ);
 	mon_ndev->name[IFNAMSIZ - 1] = 0;
-	mon_ndev->destructor = rtw_ndev_destructor;
+	#if (LINUX_VERSION_CODE>=KERNEL_VERSION(4,11,9))
+		mon_ndev->needs_free_netdev = false;
+		mon_ndev->priv_destructor = rtw_ndev_destructor;
+	#else
+		mon_ndev->destructor = rtw_ndev_destructor;
+	#endif
 	
 #if (LINUX_VERSION_CODE>=KERNEL_VERSION(2,6,29))
 	mon_ndev->netdev_ops = &rtw_cfg80211_monitor_if_ops;
-- 
2.14.1

