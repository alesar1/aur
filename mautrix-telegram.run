#!/bin/sh

cfgfile=/etc/mautrix-telegram/config.yaml
regfile=/etc/mautrix-telegram/registration.yaml

[ ! -f "$regfile" ] &&
  python -m mautrix_telegram --config "$cfgfile" --registration "$regfile" --generate-registration

cd /etc/mautrix-telegram || exit
alembic -x "config=$cfgfile" upgrade head

exec python -m mautrix_telegram --config "$cfgfile" --registration "$regfile"
