image: archlinux
sources:
    - https://git.sr.ht/~ineptattech/aur-als-git
packages:
    - gprbuild-bootstrap
    - xmlada
    - git
    - python-e3-testsuite
tasks:
- prepare: |
    git clone https://aur.archlinux.org/gprbuild.git
    cd gprbuild
    makepkg
    yay -R --noconfirm gprbuild-bootstrap
    makepkg -i --noconfirm
    cd ..
    yay -S --answerclean=All --noconfirm xmlada
    # Adding libadalang-git as an explicit dependency because libadalang-tools-git doesn't specify the git package
    yay -S gnatcoll-core-git libadalang-git libadalang-tools-git libvss-git ada_spawn ada-libfswatch --noconfirm
- build: |
    cd aur-als-git
    makepkg
- install: |
    cd aur-als-git
    makepkg --install --noconfirm
