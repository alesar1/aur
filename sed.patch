diff --git a/setup.py b/setup.py
index 8443ede..b4f2ec5 100644
--- a/setup.py
+++ b/setup.py
@@ -131,7 +131,7 @@ def get_files(dir, ext=None):
             ('Doc/rtshell/ja', html_files_ja + pdf_files_ja)]
 else:
     scripts = base_scripts
-    data_files = [('share/rtshell', ['bash_completion', 'shell_support.in']),
+    data_files = [('share/rtshell', ['shell_support.in']),
             ('share/man/man1', man_files_en),
             ('share/man/ja/man1', man_files_ja),
             ('share/doc/rtshell', html_files_en + pdf_files_en),
@@ -192,22 +192,21 @@ def config_bash_compl(self):
         COMPOPT_NOSPACE = 'compopt -o nospace'
         COMPOPT_FILENAME = 'compopt -o filenames'
         COMPLETE_NOSPACE = '-o nospace'
-        compl_script = '{0}/bash_completion'.format(
-                os.path.join(self.install_dir, 'share/rtshell'))
+        with open('bash_completion', 'rt') as f:
+            bash_comp = f.read()
         if sys.platform == 'darwin':
-            replace = ['-e', 's/@COMPOPT_NOSPACE@/:/g', '-e',
-                    's/@COMPOPT_FILENAME@/:/g', '-e',
-                    's/@COMPLETE_NOSPACE@/{0}/g'.format(COMPLETE_NOSPACE)]
+            bash_comp = bash_comp.replace('@COMPOPT_NOSPACE@', ':')
+            bash_comp = bash_comp.replace('@COMPOPT_FILENAMES@', ':')
+            bash_comp = bash_comp.replace('@COMPLETE_NOSPACE@',
+                    COMPLETE_NOSPACE)
         else:
-            replace = ['-e', "'s/@COMPOPT_NOSPACE@/{0}/g'".format(
-                COMPOPT_NOSPACE), '-e', "'s/@COMPOPT_FILENAME@/{0}/g'".format(
-                COMPOPT_FILENAME), '-e', "'s/@COMPLETE_NOSPACE@//g'"]
-        p = subprocess.Popen(['sed'] + replace + ['-i', '', compl_script],
-                stdout=subprocess.PIPE, stderr=subprocess.PIPE, cwd=cwd)
-        stdout, stderr = p.communicate()
-        if p.returncode != 0:
-            print 'Failed to filter bash_completion.'
-            print stderr
+            bash_comp = bash_comp.replace('@COMPOPT_NOSPACE@', COMPOPT_NOSPACE)
+            bash_comp = bash_comp.replace('@COMPOPT_FILENAMES@',
+                    COMPOPT_FILENAME)
+            bash_comp = bash_comp.replace('@COMPLETE_NOSPACE@', '')
+        with open('{0}/bash_completion'.format(
+                os.path.join(self.install_dir, 'share/rtshell')), 'w') as f:
+            f.write(bash_comp)
 
 
 setup(name='rtshell',
