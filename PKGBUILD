# Generated by debtap
# Maintainer: Ricardo Band <email@ricardo.band>
# Contributor:
pkgname=sensu
pkgver=1.4.2
pkgrel=2
_debver='1.4.2-1'
pkgdesc="A monitoring framework that aims to be simple, malleable, and scalable."
arch=('x86_64')
url='https://sensu.io'
license=('MIT')
backup=('etc/default/sensu' 'etc/logrotate.d/sensu')
options=('!strip' '!emptydirs')
optdepends=('redis: sensu data store'
            'rabbitmq: sensu transport'
            'uchiwa: simple web dashboard')
install=${pkgname}.install
source=("https://repositories.sensuapp.org/apt/pool/stretch/main/s/${pkgname}/${pkgname}_${_debver}_amd64.deb")
sha1sums=('e4b6a914fe32c96e0c05cad5915cf862ee49b078')

package() {
	# Extract package data
	tar xzf data.tar.gz -C "${pkgdir}"

    # Copy licences
    install -D -m644 "${pkgdir}/opt/sensu/LICENSE" "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
    cp -r "${pkgdir}/opt/sensu/LICENSES" "${pkgdir}/usr/share/licenses/${pkgname}/LICENSES"

    # Fix directories structure differencies
	mkdir -p ${pkgdir}/usr/lib ${pkgdir}/run
    mv ${pkgdir}/lib/* ${pkgdir}/usr/lib/
    mv ${pkgdir}/var/run/* ${pkgdir}/run/
    rm -rf ${pkgdir}/var/run ${pkgdir}/lib
}
