# Generated by [gen_mc_aur_pkg](https://github.com/isac322/gen_mc_aur_pkg)

# Maintainer: Byeonghoon Yoo <bh322yoo@gmail.com>

# Based on the 'forge-server' AUR package by:
# Maintainer: Nitroretro <nitroretro@protonmail.com>

# Based on the `minecraft-server` AUR package by:
# Maintainer: Gordian Edenhofer <gordian.edenhofer@gmail.com>
# Contributer: Philip Abernethy <chais.z3r0@gmail.com>
# Contributer: sowieso <sowieso@dukun.de>


pkgname='fabric-server-1.17.1'
pkgver='1.17.1_0.7.4'
pkgrel=1
pkgdesc="Minecraft 1.17.1 fabric server unit files, script, and jar"
arch=('any')
url="https://fabricmc.net"
license=("Apache")
depends=('java-runtime-headless>=16' 'tmux' 'sudo' 'bash' 'awk' 'sed')
optdepends=("tar: needed in order to create world backups"
	"netcat: required in order to suspend an idle server")
provides=("fabric-server=${pkgver}")
backup=('etc/conf.d/fabric-1.17.1')
# See https://launchermeta.mojang.com/mc/game/version_manifest.json for a list of all releases
source=("fabric-installer-0.7.4.jar"::"https://maven.fabricmc.net/net/fabricmc/fabric-installer/0.7.4/fabric-installer-0.7.4.jar"
	"fabricd-1.17.1-backup.service"
	"fabricd-1.17.1-backup.timer"
	"fabricd-1.17.1.service"
	"fabricd-1.17.1.sysusers"
	"fabricd-1.17.1.tmpfiles"
	"fabricd-1.17.1.conf"
	"fabricd-1.17.1.sh")
noextract=("fabric-installer-0.7.4.jar")
sha512sums=(
            'd4fe643f9e208533f5768ae17057419d060df6fe5c2f65a08e0edcb6f88033666b4916f35e41cfe1b78e03c14f46764a783e7312e5502768300c437c6df6eab0'
            'a3edf08518f6642101d3c49a604d0cbae76f3b6ee9e0260089521152cefd64602365efafaa534854fa5201bcbc8ffc99bf3421704caff4a904abbde7c05e7e35'
            'd4fe643f9e208533f5768ae17057419d060df6fe5c2f65a08e0edcb6f88033666b4916f35e41cfe1b78e03c14f46764a783e7312e5502768300c437c6df6eab0'
            'c80965fc0daa8d2287af0238bc70e3010682ea7a10f33d1ac2cd1e5ec3b3a019c3624beb21da754e3cb02f3f8e19f740e36f93810b6ad7fb7ac59ace10a67b68'
            '32e455e62c5b02964abfe7b90aab159833aa2641856707252950c80161b3053d697ce658d313560bcbeb2fb9f0ac28410d14aad251fe0ac6f48db2e435d4813c'
            'e41d4eda022d46eba15d2958859f05324851d8e33e7824c58d021547efb6e174f40005f314ff7321a9748ee89e96682d1ca3acafd35becf2f057de290ef54499'
            'd90649119fea66031e4db3535eb9dc6deeb6ad559777464ef2f4190469cb435193def2fb9580c58dc1981c79c995414f885c90fb529a34fa3d97cc899354a62b'
            '142e595a1f467af959572cef3fcbfed2e000b8b58e784c54ef8e762694610938dbb96b3f8c18449433f620e96c18f6916f34c7a3608282f9f8257d03c5801948')

_server_root="/srv/fabric-1.17.1"

prepare() {
	java -Duser.home="${srcdir}" -jar "fabric-installer-0.7.4.jar" server -mcversion 1.17.1 -downloadMinecraft
}

package() {
	install -Dm644 fabricd-1.17.1.conf             "${pkgdir}/etc/conf.d/fabric-1.17.1"
	install -Dm755 fabricd-1.17.1.sh               "${pkgdir}/usr/bin/fabricd-1.17.1"
	install -Dm644 fabricd-1.17.1.service          "${pkgdir}/usr/lib/systemd/system/fabricd-1.17.1.service"
	install -Dm644 fabricd-1.17.1-backup.service   "${pkgdir}/usr/lib/systemd/system/fabricd-1.17.1-backup.service"
	install -Dm644 fabricd-1.17.1-backup.timer     "${pkgdir}/usr/lib/systemd/system/fabricd-1.17.1-backup.timer"
	install -Dm644 fabricd-1.17.1.sysusers         "${pkgdir}/usr/lib/sysusers.d/fabricd-1.17.1.conf"
	install -Dm644 fabricd-1.17.1.tmpfiles         "${pkgdir}/usr/lib/tmpfiles.d/fabricd-1.17.1.conf"
	install -Dm644 server.jar                      "${pkgdir}${_server_root}/server.jar"
	install -Dm644 fabric-server-launch.jar        "${pkgdir}${_server_root}/fabric-server-launch.jar"

	# Link the log files
	mkdir -p "${pkgdir}/var/log/"
	install -dm2755 "${pkgdir}/${_server_root}/logs"
	ln -s "${_server_root}/logs" "${pkgdir}/var/log/fabric-1.17.1"

	# Give the group write permissions and set user or group ID on execution
	chmod g+ws "${pkgdir}${_server_root}"
}
