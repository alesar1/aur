# Generated by [gen_mc_aur_pkg](https://github.com/isac322/gen_mc_aur_pkg)

# Maintainer: Byeonghoon Yoo <bh322yoo@gmail.com>

# Based on the 'forge-server' AUR package by:
# Maintainer: Nitroretro <nitroretro@protonmail.com>

# Based on the `minecraft-server` AUR package by:
# Maintainer: Gordian Edenhofer <gordian.edenhofer@gmail.com>
# Contributer: Philip Abernethy <chais.z3r0@gmail.com>
# Contributer: sowieso <sowieso@dukun.de>


pkgname='fabric-server-1.17.1'
pkgver='1.17.1_0.7.4'
pkgrel=3
pkgdesc="Minecraft 1.17.1 fabric server unit files, script, and jar"
arch=('any')
url="https://fabricmc.net"
license=("Apache")
depends=('java-runtime-headless>=16' 'tmux' 'sudo' 'bash' 'awk' 'sed')
optdepends=("tar: needed in order to create world backups"
	"netcat: required in order to suspend an idle server")
provides=("fabric-server=${pkgver}")
backup=('etc/conf.d/fabric-1.17.1')
# See https://launchermeta.mojang.com/mc/game/version_manifest.json for a list of all releases
source=("fabric-installer-0.7.4.jar"::"https://maven.fabricmc.net/net/fabricmc/fabric-installer/0.7.4/fabric-installer-0.7.4.jar"
	"fabricd-1.17.1-backup.service"
	"fabricd-1.17.1-backup.timer"
	"fabricd-1.17.1.service"
	"fabricd-1.17.1.sysusers"
	"fabricd-1.17.1.tmpfiles"
	"fabricd-1.17.1.conf"
	"fabricd-1.17.1.sh")
noextract=("fabric-installer-0.7.4.jar")
sha512sums=(
            'TODO'
            '71e23dcc8460bf84b5c23672d532a43dd41cddc79c82bc64e8225ca3db5dc6d645cff87c9560555c1c21ab0bc67eccde639ac50c1b099853055580e330a0579a'
            'd4fe643f9e208533f5768ae17057419d060df6fe5c2f65a08e0edcb6f88033666b4916f35e41cfe1b78e03c14f46764a783e7312e5502768300c437c6df6eab0'
            '456fcb34cc32431f5b739aa6ed2e01699e6904c8a458afa8683ca77d940b24220d707ea256403c6e21fb5d6e434f252f69795dc5ab8dc239165a74c7d30938fb'
            '14ca7a3bdc98079112d2fb05119e0f410a0aa7cb9432b289542a0c7213d5d3c24e4b27ef1861a95e1a70a310886b887a793fe7afc2f749c640543eb1390be22c'
            '636aa7fa1f0dd45ea2ebb8d6ae4fdead3b97930e5cfd6924c59956f1ce689d59d202ce66eee6b2cb6a1c096c3f02b5ea94962b5b41abd3c1b17d43f33c714fd7'
            '1d90a63c5fc7c2ac0a814f6c4c9f84aa93217e3b4496f68ba78458d0bf15ffbff6dc8e4e547c9a5c879147b36ab770e4b6912147eb967857c1488e2634c7aa1c'
            '742667cb1849862c85f67410361b817012e0fa79485ada4c4564352d67cb2c687965399bb5050b269ef7f7edacdd81ec1c4089cfc1deea4efba3b7d4866bd53e')

_server_root="/srv/fabric-1.17.1"

prepare() {
	java -Duser.home="${srcdir}" -jar "fabric-installer-0.7.4.jar" server -mcversion 1.17.1 -downloadMinecraft
}

package() {
	install -Dm644 fabricd-1.17.1.conf             "${pkgdir}/etc/conf.d/fabric-1.17.1"
	install -Dm755 fabricd-1.17.1.sh               "${pkgdir}/usr/bin/fabricd-1.17.1"
	install -Dm644 fabricd-1.17.1.service          "${pkgdir}/usr/lib/systemd/system/fabricd-1.17.1.service"
	install -Dm644 fabricd-1.17.1-backup.service   "${pkgdir}/usr/lib/systemd/system/fabricd-1.17.1-backup.service"
	install -Dm644 fabricd-1.17.1-backup.timer     "${pkgdir}/usr/lib/systemd/system/fabricd-1.17.1-backup.timer"
	install -Dm644 fabricd-1.17.1.sysusers         "${pkgdir}/usr/lib/sysusers.d/fabricd-1.17.1.conf"
	install -Dm644 fabricd-1.17.1.tmpfiles         "${pkgdir}/usr/lib/tmpfiles.d/fabricd-1.17.1.conf"
	install -Dm644 server.jar                      "${pkgdir}${_server_root}/server.jar"
	install -Dm644 fabric-server-launch.jar        "${pkgdir}${_server_root}/fabric-server-launch.jar"

	# Link the log files
	mkdir -p "${pkgdir}/var/log/"
	install -dm2755 "${pkgdir}/${_server_root}/logs"
	ln -s "${_server_root}/logs" "${pkgdir}/var/log/fabric-1.17.1"

	# Give the group write permissions and set user or group ID on execution
	chmod g+ws "${pkgdir}${_server_root}"
}
