# Maintainer: chn <g897331845@gmail.com>
# Contributor: AkinoKaede <autmaple@protonmail.com>
# Contributor: DuckSoft <realducksoft@gmail.com>
# Contributor: Felix Yan <felixonmars@archlinux.org>
# Contributor: pandada8 <pandada8@gmail.com>

pkgname=xray-bin
pkgver=1.5.3
pkgrel=1
pkgdesc="The best v2ray-core, with XTLS support."
arch=(x86_64 i686 aarch64 armv5h armv6h armv7h mips64el mipsel mips64 mips ppc64el ppc64 riscv64 s390x)
url="https://github.com/XTLS/Xray-core"
license=('MPL2')
depends=('glibc' 'v2ray-domain-list-community' 'v2ray-geoip')
backup=('etc/xray/config.json')
provides=("${pkgname%-bin}")
conflicts=("${pkgname%-bin}")
#validpgpkeys=()  # ?

sha512sums=(
  '2000211cbf987adaee7f278cc8cb23268965caab3bc46401f9324f2beaad95bec11012f5f4500f1016f4b75f097f3ac96cc5be2da7a6df0261582b3f23b3d78d'
  '9914fd3da02511b716951e521ca22006a6e8ad66e64d32cc7dd7dc3544a754174b37e35df6108ca217130f02763265d74f8bc56c4e52b262bdd48dcdb5310eb5'
  '532f66fe19196de0cc43df1812d6f32cbca7bbcacaa0cd4141bd80b3121b17eb8b23e0464765cf05a97b11e0213fb688eade83e393e36b3e7ebded6f0925de97'
  'b9bfe018e0b04e9269d4a779c50222dbf5653051533f78a511cdbd17bd9744715ea4f9127b30a6c74d8ffcbca1f22a271c53997758a3190f4dde6d17f313d8ac'
  '7c96cbea8d8e34d2458c3aeb31b03e9f322e3774193e0458f003f2336c7ff39b65a94840942f09b7c5e96287c74cdd8b7b96717e38ff230161ad887d34a86d8f'
  #''
)
b2sums=(
  '526946157d16bec475d727881194362370d70d06c316c4d9134872a5993f58023de649250dcfc90268c90eda526f5607947ab389e827a0cf81b99c01425887d2'
  '28d479130bac57fccf4a699df516c14737ecfde3f183fdd7c29f7c318b1b87cb0415f4ddba4ac947448df19e118bd9c9d1bd01e0b36b838268873c35dbe7115e'
  '3be47a2439dccfdcd6f0ee86a63e74c15731a70c9fe4ec801a009e62e54d4cae17adce723a704ed1effe81b367e51bbf1055cfeba82346f88a35f3f2dac08b32'
  'fd2c42bd5bd213060aaa31d946d7bc2c3bd2a00fd022cfab094da4c7e5f08e395f8fda2525c157081a7ef45c937f8712a6d1aad10d36c9b590ddd1d279b14b8b'
  '24486760e187641a49c84756b433a41643bb90aa24de2bd827dc039a3e25faabf109309082e8f6c9a2677ecc595c19446d4eef838cd5565a4b02ec022ade625f'
  #''
)
b3sums=(
  'b024e591aed189dbd7e8472cc431574fddbb26d2a5d345ebd7fef7a88a28016c'
  '40277afc77611025e5a508f2403105be2849d3b99b743bf357fe0ad79ca93c4d'
  '355f1d9de26e27996600762a5ea67fa59491245e2527a0780a3a83a8c78ada80'
  '84fb38b1876fe21c3553916a855ee63a8dfc16b72ac6d3e83edadc20a767f4ac'
  '58e7027bae7dfeeed9a87a5d69296bec2658b6f4807895afa6162cfe19067705'
  #''
)
_KERNEL="$(uname -s)"

case "${_KERNEL,}" in
  freebsd) case "${CARCH}" in
    x86_64)
      _CARCH="64"
      sha512sums=('113776d6f384bcba5523b9e7f2372e09a4ae96770251512ffb2b01c68c72f5b185254e711d146abf2d485cfffc73e97f6578b1fa7da886579f4bc47c70206055')
      b2sums=(    '519980348da31056ab94295906a85a8be23254f1b1f2338c349b61e2a6734f645ee098820bf0048bc17ddac884efad4d6e8570d5ab1181b2536a56dd654895d8')
      b3sums=(    'a58baa787c56206f3b1ab6199c72cb10420f07ee594f8d846fd8dad0f5a43fb7')
    ;;
    i*86)
      _CARCH="32"
      sha512sums=('d509a9d47abc9b86aa121222cda682c610a6df995b98ba08aa3249afbd1d27e5471dc351db075aadd8de4369c9d6fde055cff205ff61f63dc8aeb40e5540c5d5')
      b2sums=(    'ec3670a3989c4ff4bcba6a23ee4aa843f842d060dd2a9371e41baebaf9251593f82086d203e6d9750fe5431cf19107336954b94ecce0baf3dcde5f673d107367')
      b3sums=(    '934dff56df53eae32ea42357e23cd49e2a6dad033200109d72d4d329cb665051')
    ;;
    aarch64)
      _CARCH="arm64-v8a"
      sha512sums=('8b4c888581330d296263f18368e81d3c8d8782ee710b003c067c0b168ae15dba3bad5b37e20bf6d1a12dbb8a599d0e77b1146eb48befdf8b6d66e317636efbbf')
      b2sums=(    'c54145bd9891d5f59661b4f1286e869c3c6e913764c17e4f6a0400ce56dbea219f97dbc0af97bf48ff020466010d7b091acbed0a3c50e141ece7275e1685c65b')
      b3sums=(    '7595056264aa69af2311221db0c3e8f3fcaa519dcd6e5d968c75e7b57b299233')
    ;;
    armv7*)
      _CARCH="arm32-v7a"
      sha512sums=('c7a9213fc7be3073d0b1b0b7e70bc4b9f662c1315ab6a9fce73f218e4ed89bc3382e490116ffa8d54c4982a7315a16bf2702a75c7cd39d4367a9eb0e68dd9d67')
      b2sums=(    'acd8f2700914441eabc72a809795a2ce74569edf4ad41e39c35dd7f5766189913e169295b2b1526d4a0a8575cbdcd1e7886d0b100d5d3ff84fca2120ed370e65')
      b3sums=(    '2ac4df916a5c529a08ff1f258e3adc2c753ea1fa8f588686262282313cfcce68')
    ;;
  esac;;
  linux) case "${CARCH}" in
    x86_64)
      _CARCH="64"
      sha512sums=('54bd46dbd7e1e590b1f259ad53a121127b119a7e2bf13a765681f96c73005459914907b118f5815b2e7368620bb14da87f224ad397e660b38e7d9aaeba37ea1f')
      b2sums=(    '8f1443c031f066091f2c4e427215f3b161ac1f622ec21858108caebbb48ba867c1f4b2de70826cf2daac0698b093aeacc1d19865af7cd00d0cc32adcbfb0366f')
      b3sums=(    'f17636497da076c8397083868cca620d71c3b35ec629183b17ede840cf666a6c')
    ;;
    i*86)
      _CARCH="32"
      sha512sums=('de0b65fc1340e6df9db2fafba2f159355ba7c2c63ce4544149b553e2b5820215857be0f65e09f3f6fba857c41984baf65526a167c46eb240a58be9455b7e1add')
      b2sums=(    '5ed818f752c38384117bcfe9566e5c4bea8de98759c384b2f6caebc4a20f784ef6c65266189f4ae4113b149772040f427edf50b0886659489986ebfda48daf0e')
      b3sums=(    '042b873a19cff83b180d1bf04fb70d719baae405a991fd9bf177653d0c62e0ce')
    ;;
    aarch64)
      _CARCH="arm64-v8a"
      sha512sums=('54686e83569fbdeea95ab8426b762802bb1d168b734acf334c8a83ade8e9e01b83edaef7d29e784475b7e551178e0d83fb954ef644552852c839f55ca443119a')
      b2sums=(    'd229edf906a60dbaa9e181846acd0d15dde8c048d8cea6c163ec3398b6573067ea4f92a832206ff5b74a4ab37cbbd9f7852a2e81abdfadc8132e96491ca9b99b')
      b3sums=(    '226b7300992dede931d45e04f0b9b5a5dd6d8f314343c215d845ab594aa8c82b')
    ;;
    armv5*)
      _CARCH="arm32-v5"
      sha512sums=('b998141991c8ef9aee30f7af0882a9a83867d46d05542d67e8d2e58a28fd6c1d28405ad8a7ea338cac52387d4fe29ea493a8fa020a7596bc7038db92d80428f3')
      b2sums=(    '3779ac104e0aae18859afd896d650a40d918bc79e578eaedb240b585241e00e4e79b166213160ffbc148735768c1419aa6a863782a758ab514b444d4fe31125b')
      b3sums=(    '826b9b7120ede759413c9bdc7656a1768455aab65b55b7f18c677bce94b69b18')
    ;;
    armv6*)
      _CARCH="arm32-v6"
      sha512sums=('a1eccf8c845bd6e7358cdb7df103d4a0ff65659b5ca3288413290f46234a23ba411ec0eab0501be6e422d80402b16c55a2f8225d705b17edd5532989f7efd0e0')
      b2sums=(    'a26da879ed70bcebf841830df6f9c3ffaa1b28b644ca78129b41243213d53e7f7ce2c704ee06c08bea6c51d7e365f678b7b62019e9d0e6d1b845ba8962e7a1b3')
      b3sums=(    '50c7b26d611935a894f897f043955c45250267479ce99982d99b718db79cec53')
    ;;
    armv7*)
      _CARCH="arm32-v7a"
      sha512sums=('5cf75b7dce80d509613961d80563607e1ea3646cff4cf63c8fd1006c992d133f9a4e129bde7ac381209538b2d56516005c1cc312febd62f07e634a0efe35cd6b')
      b2sums=(    '184bdd6325d9c1c979ebd36f2906ac3c34a73c9e4f4468c049e1f55d6f0d3cd66cf2053afe90a84e230c78046d3130b167c6c3ccd63485402e7a0b4fbcd89554')
      b3sums=(    '92aa5c835e3a8e1e75d8b31a5d4561805e76d0c8bbfced358d758f7c930dc2a2')
    ;;
    mips64el)
      _CARCH="mips64le"
      sha512sums=('0a39c37c671dcbb87fe176807faefe4a8dd251f6468ed265c1b8cdc56a412413a4e4ad107320bd7d57003ee4b1034526dfc0064a63a192dbf0107f9991d6076b')
      b2sums=(    'f4ee1fafd1c7b86704ed87f47d28b2168f07d3a290db1d34c777973d3c223aac59da2a578e2af5d2010cb0e7e4cff696b939e67374bf8e3f23856ae268acdb85')
      b3sums=(    '8542abd1098e4a55e985757d16731d8da2deb68eb8fc40e2897d599e427dfb46')
    ;;
    mipsel)
      _CARCH="mips32le"
      sha512sums=('c6de6a9f17d905f6dac79a04f47fc69c9fdfb904d7b7d08e6e0db11696ce19901274f76bdaba218606908a103e77ee55293560438018b93a0e9e659a27b72ad7')
      b2sums=(    '130eb77c53820fc1db8641f2b00a58b35af3edf79b0dd762acc93081ccb29b51ccb62dd6d9da7bebe5040f21252e7b7078a0f959f6d709efed54d162a350954b')
      b3sums=(    'aea428ee073e6cfb2367a44372dc2f987ca0beda66e0bda902a4d01c09dc26a0')
    ;;
    mips64)
      _CARCH="mips64"
      sha512sums=('8fd909dfa9626ac25057557c613e0e0076c5bb485c4bf5986a8e770e1d86d5a306f3e7a70fe6e32ff42f9014e9c30db613da7f6e320317304580ca8ceceea514')
      b2sums=(    'd82da83a494cb061bb34778af8d9754652f060dad4ba78aa0032d68d1b034f766e3743781c3e2d3be2a182f20d843f511dbddf5cd3a1c322e8f16726cbed6dfe')
      b3sums=(    '4f6cb8aecd67d6e4fe4a97fb48864a329c05d08f868561975e83afa5a774689e')
    ;;
    mips)
      _CARCH="mips32"
      sha512sums=('e45259616841f488859c40f88f787bf8c1346a5db53ec6e2607e1093b06b220afe7198c116fbd9c5b32460051b6bae76cd819e7f394502503d4a9db07262c5fc')
      b2sums=(    'e688e48a775955974c607a791303733a825a3e15b925e687a773195eb5ceb6ca4d31da84111077f7f73a034ad64b2467447a927ca2de1e0e09973fbc1225bfa6')
      b3sums=(    'b2642bd92870161259fe7b39ae1e57054bfcc16876d16197e0f77d90690c5254')
    ;;
    ppc64el)
      _CARCH="ppc64le"
      sha512sums=('7d579a7c01b633d3860b33868d4225507abb097f224a09377bc5613f21a1625be3e9a38045421c0335f83dbfc9c5fe8f9f87a05c669ab670c383627838d67db0')
      b2sums=(    '9217cfcce6e0177f28aa1ee88f73908b81337518061ccc4aabf8cdafaa2e8a3a6987b8d18a44fd5cbcb3696937303c4cd03348eaf716822e0d56fa57f3a0f58b')
      b3sums=(    'c9d097a75d0e80bc40815b917515a1932df410d4471ce0f3736977db33e0a427')
    ;;
    ppc64)
      _CARCH="ppc64"
      sha512sums=('3661b7a27569491b71a496c6904a61f3e0d276151d911c84cbd76e2921526d3e6d8e1e90f29a2497a3a1d07915e41a08126fe9cc0c49304433303afb51be72dd')
      b2sums=(    'fbefbd0feb9e2f3d6d925f1909d0bf2aea8ffecfabaf712286fbaf1219d09935b31c0019636f5f7f9937d30f4435423102e0386a6d232b3af172ab8bc909f118')
      b3sums=(    '1646bd009c39d97889c0886e6a6c97228b7f3ab3ac2bd148259526549fd114f1')
    ;;
    riscv64)
      _CARCH="riscv64"
      sha512sums=('e2a14710609d56acff0e069eeccc7f09c17c36f2e6c82859bfb3d25ee9387354b7d0036997e540c9472aeacab652d8d913a5c3b3ef6914259203e4ca40f12284')
      b2sums=(    '58d99d752d6d63b585ba866341d7382ce4b063e7b9510690b4f58bf6dedb077a9891ac1a6fb6928d261718d00b73dbba7eeb01bfded67b50edc107a11ae2ceaf')
      b3sums=(    'c42d3fd21f980c02e0d76501780e9f9b22a8e8be1414a15f135439ca40310ad4')
    ;;
    s390x)
      _CARCH="s390x"
      sha512sums=('91ddf23b36649d5691cc997d63ca36d0e7f5ad84a2129c99bf62c28f5e93a34cab0b6e78960697d38511a159b700b8a4bdac2c9a2940c4db0aea0acd892b0b6b')
      b2sums=(    '5029a3b2be509097f0b803aa8a18b3bfa406ce844d03846b93be767fdffec3a37948702fe3dced7a45e7edd9b16882f77e1df47d29665624733e929a9c192d3a')
      b3sums=(    '0e2b408d239362a2031c7d0db41bc0a95821f0aad9c234b6c567524c00c31a59')
    ;;
  esac;;
  openbsd) case "${CARCH}" in
    x86_64)
      _CARCH="64"
      sha512sums=('259e03f62a1ad5eeb105480c2870fd1b59681f1deff73511fc85210869adc84af72488b26a812ea9268a5ef9ca67ef31773ed511fa34b9b8142ce6c4cae1835a')
      b2sums=(    'b81fe7e4a69e506e1382ec8e47b751fe402a45806fb0b2ae38347ba6aa143f4746799f8bfee1a23a5c9ee0fa9a76b3a6752881ec4f4aadd731ddc150000f8ee2')
      b3sums=(    'd1c64c50d10e59f04fe60879354420806a884b4e392421e651a75c0b6a1192aa')
    ;;
    i*86)
      _CARCH="32"
      sha512sums=('7b4ed0ed2d50217d467c8fb24b8e3024700f90986ec27a784ea893352022cc85ac57365658b0236f14261488afd7620b7ab2809c299a6130517df85ba2e7e496')
      b2sums=(    '579c6c84fffc21c116c8b86b978a1e89aaed9f6657816ae194e7c7eed1ac105607bd79ac74a304bd874da6e579cbfe4aba36dcd25ef5c7e0a6ee4833dd76f459')
      b3sums=(    '7993b8a32e74f2623aa12e028e295b9d676f0f95c1017750b85c6a3b9823ba06')
    ;;
    aarch64)
      _CARCH="arm64-v8a"
      sha512sums=('925bda47ed7215f060912f73128a889d52204723e551a71bc51e523142f18a27dbe388e094ebd384d4fb9db855331316e9e807fcc00981f9d4b72f6aedb89118')
      b2sums=(    '7c1bdf9d415dc89b45a198285b4a33e5f490dc1d0df6b73d569631893692bfd5fdaa0abfabb16aed9578ff8b75d4e91c8430316ded6065a04f672887969efc63')
      b3sums=(    '4f7aba5c5ead750cb54b505219ba5623c69e3b5621185d999d0c4a81221b6703')
    ;;
    armv7*)
      _CARCH="arm32-v7a"
      sha512sums=('f6698e245b64db592c15c0c00e811079b56019a4e7409127db435703a1ce44e09e7660aae0958a72e8c71f9ddda40949f4878167b9214e3e41470be1f5c0b964')
      b2sums=(    '04efe3cacca04cfdcd7a718fed1b3c03112f23fe21fa146ec71f8999f34fa68041d97437d1b59485231551981b3fe67572e332a9dbfb786e0e72d90bb4eef2fb')
      b3sums=(    '612bfb82ee8c5b8aa51302ac518e2738d44df7f4bebf97b619f71528afd03416')
    ;;
  esac;;
esac
source=(
    "config.json"
    "vpoint_socks_vmess.json"
    "vpoint_vmess_freedom.json"
    "xray.service"
    "xray@.service"
    #"${pkgname}-${pkgver}-${_KERNEL,}-${_CARCH}.tar.gz.dgst::${url}/releases/download/v${pkgver}/Xray-${_KERNEL,}-${_CARCH}.zip.dgst"
    "${pkgname}-${pkgver}-${_KERNEL,}-${_CARCH}.tar.gz::${url}/releases/download/v${pkgver}/Xray-${_KERNEL,}-${_CARCH}.zip"
)

package() {
    cd "${srcdir}"
    install -Dm644 LICENSE "${pkgdir}"/usr/share/licenses/xray/LICENSE
    install -Dm644 xray.service "${pkgdir}"/usr/lib/systemd/system/xray.service
    install -Dm644 xray@.service "${pkgdir}"/usr/lib/systemd/system/xray@.service
    install -Dm644 *.json -t "${pkgdir}"/etc/xray/
    install -Dm755 xray -t "${pkgdir}"/usr/bin/
}

