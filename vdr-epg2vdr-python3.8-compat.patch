Author: seahawk1986
https://www.vdr-portal.de/forum/index.php?thread/133185-vdr4arch-epg2vdr-scraper2vdr/&postID=1320317#post1320317

diff --git a/Make.config b/Make.config
index 85024f4..2d2296d 100644
--- a/Make.config
+++ b/Make.config
@@ -19,6 +19,9 @@ PREFIX = /usr/local
 DEBUG = 1
 #USE_CLANG = 1
 
+# set python interpreter
+PYTHON = python
+
 # -----------------------
 # don't touch below ;)
 
@@ -35,6 +38,17 @@ doLib     = ar -rs
 USEPYTHON = 1
 USEEPGS   = 1
 
+ifdef USEPYTHON
+  ifeq ($(shell $(PYTHON) -c 'import sys; sys.exit(0) if sys.version_info[:2] < (3,8) else print(1)'), 1)
+    PYTHON_LIBS = $(shell $(PYTHON)-config --libs --embed)
+  else
+    PYTHON_LIBS = $(shell $(PYTHON)-config --libs)
+  endif
+  LIBS += $(PYTHON_LIBS)
+  BASELIBS += $(PYTHON_LIBS)
+  CXXFLAGS += $(shell $(PYTHON)-config --includes)
+endif
+
 USES = -DVDR_PLUGIN -DUSEUUID -DUSEMD5 -DUSEJSON -DUSEGUNZIP -DPLUGIN_NAME_I18N='"$(PLUGIN)"'
 
 ifdef DEBUG
diff --git a/Makefile b/Makefile
index 1403938..f112dfe 100644
--- a/Makefile
+++ b/Makefile
@@ -66,11 +66,16 @@ OBJS = $(PLUGIN).o \
        status.o ttools.o svdrpclient.o \
        menu.o menusched.o menutimers.o menudone.o menusearchtimer.o
 
-LIBS  = $(HLIB)
+LIBS += $(HLIB)
 LIBS += -lrt -larchive -lcrypto
 LIBS += $(shell pkg-config --libs uuid)
 LIBS += $(shell pkg-config --libs tinyxml2)
-LIBS += $(shell mysql_config --libs_r) $(shell python-config --libs) $(shell pkg-config --libs jansson)
+LIBS += $(shell mysql_config --libs_r)
+ifdef USEPYTHON
+  CFLAGS += $(shell python-config --includes)
+  LIBS += $(PYTHON_LIBS)
+endif
+LIBS += $(shell pkg-config --libs jansson)
 
 EPG2VDR_DATA_DIR = "/var/cache/vdr"
 
diff --git a/lib/Makefile b/lib/Makefile
index 07c3e36..a752842 100644
--- a/lib/Makefile
+++ b/lib/Makefile
@@ -25,7 +25,7 @@ endif
 CFLAGS += $(shell pkg-config --cflags uuid)
 CFLAGS += $(shell pkg-config --cflags zlib)
 
-BASELIBS = -lrt
+BASELIBS += -lrt
 BASELIBS += $(shell mysql_config --libs_r)
 BASELIBS += $(shell pkg-config --libs uuid)
 BASELIBS += $(shell pkg-config --libs zlib)
@@ -36,11 +36,11 @@ ifdef USECURL
 endif
 
 ifdef USEEPGS
-	LIBOBJS += searchtimer.o
+   LIBOBJS += searchtimer.o
 endif
 
 ifdef USEPYTHON
-	BASELIBS += $(shell python-config --libs)
+   BASELIBS += $(PYTHON_LIBS)
    LIBOBJS += python.o
 endif
 
@@ -50,16 +50,12 @@ endif
 
 ifdef SYSD_NOTIFY
    BASELIBS  += $(shell pkg-config --libs libsystemd-daemon)
-	CFLAGS += $(shell pkg-config --cflags libsystemd-daemon)
+   CFLAGS += $(shell pkg-config --cflags libsystemd-daemon)
 endif
 
 CFLAGS += $(shell mysql_config --include)
 DEFINES += $(USES)
 
-ifdef USEPYTHON
-	CFLAGS += $(shell python-config --includes)
-endif
-
 all: lib $(TEST) $(DEMO)
 lib: $(LIBTARGET).a
 
diff --git a/lib/db.c b/lib/db.c
index 2554cd8..84f4267 100644
--- a/lib/db.c
+++ b/lib/db.c
@@ -1379,11 +1379,19 @@ int cDbConnection::errorSql(cDbConnection* connection, const char* prefix,
 
    if (error == CR_SERVER_LOST ||
        error == CR_SERVER_GONE_ERROR ||
+// for compatibility with newer versions of MariaDB library
+#ifdef CR_INVALID_CONN_HANDLE
        error == CR_INVALID_CONN_HANDLE ||
+#endif
        error == CR_COMMANDS_OUT_OF_SYNC ||
        error == CR_SERVER_LOST_EXTENDED ||
        error == CR_STMT_CLOSED ||
+// for compatibility with newer versions of MariaDB library
+#ifdef CR_CONN_UNKNOW_PROTOCOL
        error == CR_CONN_UNKNOW_PROTOCOL ||
+#else
+       error == CR_CONN_UNKNOWN_PROTOCOL ||
+#endif
        error == CR_UNSUPPORTED_PARAM_TYPE ||
        error == CR_NO_PREPARE_STMT ||
        error == CR_SERVER_HANDSHAKE_ERR ||
