From 83c85fa8d7f69890e85018cf8e45d8b2e98b3486 Mon Sep 17 00:00:00 2001
From: Donald Carr <sirspudd@gmail.com>
Date: Tue, 15 Mar 2016 13:25:36 -0700
Subject: [PATCH] Adjust Raspberry Pi integration to new API

Change-Id: I7ef64e5dd5e87e62ec83fc05076a5c2e93d11638
---
 src/hardwareintegration/compositor/brcm-egl/brcm-egl.pri       |  2 +-
 .../compositor/brcm-egl/brcmeglintegration.cpp                 | 10 ++--------
 .../compositor/brcm-egl/brcmeglintegration.h                   |  3 +--
 3 files changed, 4 insertions(+), 11 deletions(-)

diff --git a/src/hardwareintegration/compositor/brcm-egl/brcm-egl.pri b/src/hardwareintegration/compositor/brcm-egl/brcm-egl.pri
index 83c7b62..f478071 100644
--- a/src/hardwareintegration/compositor/brcm-egl/brcm-egl.pri
+++ b/src/hardwareintegration/compositor/brcm-egl/brcm-egl.pri
@@ -1,4 +1,4 @@
-QT = compositor compositor-private core-private gui-private
+QT = waylandcompositor waylandcompositor-private core-private gui-private
 
 INCLUDEPATH += $$PWD
 
diff --git a/src/hardwareintegration/compositor/brcm-egl/brcmeglintegration.cpp b/src/hardwareintegration/compositor/brcm-egl/brcmeglintegration.cpp
index 08df635..508e882 100644
--- a/src/hardwareintegration/compositor/brcm-egl/brcmeglintegration.cpp
+++ b/src/hardwareintegration/compositor/brcm-egl/brcmeglintegration.cpp
@@ -36,7 +36,6 @@
 
 #include "brcmeglintegration.h"
 #include "brcmbuffer.h"
-#include <QtWaylandCompositor/private/qwlsurface_p.h>
 #include <QtWaylandCompositor/qwaylandsurface.h>
 #include <qpa/qplatformnativeinterface.h>
 #include <QtGui/QGuiApplication>
@@ -76,7 +75,7 @@ BrcmEglIntegration::BrcmEglIntegration()
 {
 }
 
-void BrcmEglIntegration::initializeHardware(QtWayland::Display *waylandDisplay)
+void BrcmEglIntegration::initializeHardware(struct ::wl_display *display)
 {
     Q_D(BrcmEglIntegration);
 
@@ -114,7 +113,7 @@ void BrcmEglIntegration::initializeHardware(QtWayland::Display *waylandDisplay)
             return;
         }
         d->valid = true;
-        init(waylandDisplay->handle(), 1);
+        init(display, 1);
     }
 }
 
@@ -147,11 +146,6 @@ void BrcmEglIntegration::bindTextureToBuffer(struct ::wl_resource *buffer)
     d->eglDestroyImageKHR(d->egl_display, image);
 }
 
-bool BrcmEglIntegration::isYInverted(struct ::wl_resource *) const
-{
-    return false;
-}
-
 void BrcmEglIntegration::brcm_bind_resource(Resource *)
 {
 }
diff --git a/src/hardwareintegration/compositor/brcm-egl/brcmeglintegration.h b/src/hardwareintegration/compositor/brcm-egl/brcmeglintegration.h
index 90f447c..48dd9c4 100644
--- a/src/hardwareintegration/compositor/brcm-egl/brcmeglintegration.h
+++ b/src/hardwareintegration/compositor/brcm-egl/brcmeglintegration.h
@@ -52,10 +52,9 @@ class BrcmEglIntegration : public QtWayland::ClientBufferIntegration, public QtW
 public:
     BrcmEglIntegration();
 
-    void initializeHardware(QtWayland::Display *waylandDisplay) Q_DECL_OVERRIDE;
+    void initializeHardware(struct ::wl_display *display) Q_DECL_OVERRIDE;
 
     void bindTextureToBuffer(struct ::wl_resource *buffer) Q_DECL_OVERRIDE;
-    bool isYInverted(struct ::wl_resource *) const Q_DECL_OVERRIDE;
 
     QSize bufferSize(struct ::wl_resource *buffer) const Q_DECL_OVERRIDE;
 
-- 
2.7.3

