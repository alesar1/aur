#!/usr/bin/env python

"""
@File    :   deepl-clipboard
@Time    :   2022/04/20 10:43:11
@Author  :   Ayatale 
@Version :   1.1
@Contact :   ayatale@qq.com
@Github  :   https://github.com/brx86/
@Desc    :   Translete text in clipboard to Chinese, based on Deepl Translate API
"""

import os, json
from pyperclip import paste
from urllib.request import Request, urlopen


# 调用deepl，获取翻译结果
def reqDeeplTrans(text):
    if not text.replace("\n", "").replace("\r", ""):
        os.system("zenity --warning --text=剪贴板为空\请选择文本")
        exit(1)
    api = "http://127.0.0.1:8000/translate"
    data = json.dumps({"text": text, "target_lang": "ZH"})
    req = Request(url=api, data=bytes(data, "u8"), method="POST")
    result = json.loads(urlopen(req).read().decode("utf-8"))
    if result.get("code") == 200:
        return result.get("data")
    os.system("zenity --error --text=翻译出错\请稍后再试")
    exit(1)


if __name__ == "__main__":
    translate_results = reqDeeplTrans(paste())  # 获取剪贴板，调用翻译接口
    print(translate_results, file=open("/tmp/deepl.txt", "w"))  # 将翻译结果写入文件
    os.system(f"zenity --title=Deepl --text-info --filename=/tmp/deepl.txt")  # 显示翻译结果
