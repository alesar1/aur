diff --new-file -ur proxysql-2.2.0/deps/Makefile proxysql-2.2.0-patched/deps/Makefile
--- proxysql-2.2.0/deps/Makefile	2021-05-28 05:14:25.000000000 +1200
+++ proxysql-2.2.0-patched/deps/Makefile	2021-06-29 13:38:43.015414700 +1200
@@ -169,6 +169,7 @@
 	cd mariadb-client-library && rm -rf mariadb-connector-c-3.1.9-src
 	cd mariadb-client-library && tar -zxf mariadb-connector-c-3.1.9-src.tar.gz
 	cd mariadb-client-library/mariadb_client && patch ./plugins/auth/CMakeLists.txt < ../plugin_auth_CMakeLists.txt.patch
+	cd mariadb-client-library/mariadb_client && patch -p0 < ../ConnectorName.cmake.patch
 	cd mariadb-client-library/mariadb_client && cmake . -DOPENSSL_ROOT_DIR=$(shell pwd)/libssl/openssl/ -DOPENSSL_LIBRARIES=$(shell pwd)/libssl/openssl/ .
 #	cd mariadb-client-library/mariadb_client && cmake . -DOPENSSL_ROOT_DIR=/usr/local/opt/openssl # this is needed on MacOSX
 	cd mariadb-client-library/mariadb_client && patch libmariadb/mariadb_stmt.c < ../mariadb_stmt.c.patch
@@ -217,6 +218,7 @@
 	cd prometheus-cpp && tar --strip-components=1 -zxf civetweb-v1.11.tar.gz -C prometheus-cpp/3rdparty/civetweb
 	cd prometheus-cpp/prometheus-cpp && patch -p1 < ../serial_exposer.patch
 	cd prometheus-cpp/prometheus-cpp && patch -p0 < ../registry_counters_reset.patch
+	cd prometheus-cpp/prometheus-cpp && patch -p0 < ../histogram.cc.fix.patch
 	cd prometheus-cpp/prometheus-cpp && cmake . -DBUILD_SHARED_LIBS=OFF -DENABLE_TESTING=OFF -DENABLE_PUSH=OFF
 	cd prometheus-cpp/prometheus-cpp && CC=${CC} CXX=${CXX} ${MAKE}
 
diff --new-file -ur proxysql-2.2.0/deps/mariadb-client-library/ConnectorName.cmake.patch proxysql-2.2.0-patched/deps/mariadb-client-library/ConnectorName.cmake.patch
--- proxysql-2.2.0/deps/mariadb-client-library/ConnectorName.cmake.patch	1970-01-01 12:00:00.000000000 +1200
+++ proxysql-2.2.0-patched/deps/mariadb-client-library/ConnectorName.cmake.patch	2021-06-29 13:19:51.861267481 +1200
@@ -0,0 +1,11 @@
+--- cmake/ConnectorName.cmake	2020-06-19 03:16:18.000000000 +1200
++++ cmake/ConnectorName.cmake.new	2021-06-29 13:19:07.083221888 +1200
+@@ -22,7 +22,7 @@
+     SET(MACHINE_NAME "x64")
+   ELSE()
+     SET(MACHINE_NAME "32")
+-  END()
++  ENDIF()
+ ENDIF()
+ 
+ SET(product_name "mysql-connector-c-${CPACK_PACKAGE_VERSION}-${PLATFORM_NAME}${CONCAT_SIGN}${MACHINE_NAME}")
diff --new-file -ur proxysql-2.2.0/deps/prometheus-cpp/histogram.cc.fix.patch proxysql-2.2.0-patched/deps/prometheus-cpp/histogram.cc.fix.patch
--- proxysql-2.2.0/deps/prometheus-cpp/histogram.cc.fix.patch	1970-01-01 12:00:00.000000000 +1200
+++ proxysql-2.2.0-patched/deps/prometheus-cpp/histogram.cc.fix.patch	2021-06-29 13:37:28.508490721 +1200
@@ -0,0 +1,10 @@
+--- core/src/histogram.cc	2021-06-29 13:36:58.995962491 +1200
++++ core/src/histogram.cc.fix	2021-06-29 13:36:53.968117217 +1200
+@@ -5,6 +5,7 @@
+ #include <iterator>
+ #include <numeric>
+ #include <ostream>
++#include <limits>
+ 
+ namespace prometheus {
+ 
Binary files proxysql-2.2.0/proxysql.db and proxysql-2.2.0-patched/proxysql.db differ
Binary files proxysql-2.2.0/proxysql_stats.db and proxysql-2.2.0-patched/proxysql_stats.db differ
