From b21f97e424faac297387fb1d5c0b8eb67d804dd2 Mon Sep 17 00:00:00 2001
From: Ryan Farley <ryan.farley@gmx.com>
Date: Tue, 20 Aug 2019 00:33:08 -0500
Subject: [PATCH] read - let freetype handle 8859-1 mapping

https://www.freetype.org/freetype2/docs/reference/ft2-base_interface.html#ft_encoding
indicates that ISO-8859-1 is automatically mapped to Unicode for BDF and
PCF fonts -- trying to use FT_Select_Charmap() with FT_ENCODING_NONE
leads to an error for such fonts.
---
 read.c | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/read.c b/read.c
index bee518c..e41361a 100644
--- a/read.c
+++ b/read.c
@@ -79,10 +79,13 @@ readFile(char *filename, FontPtr font)
         return -1;
     }
 
+    /* FreeType will handle Unicode and automatically map ISO-8859-1 to
+     * Unicode for us -- everything else needs a mapping */
     encoding_name = faceEncoding(face);
     if(encoding_name == NULL) {
         symbol = 1;
-    } else if(strcasecmp(encoding_name, "iso10646-1") != 0) {
+    } else if((strcasecmp(encoding_name, "iso10646-1") != 0) &&
+              (strcasecmp(encoding_name, "iso8859-1") != 0)) {
         if(reencode_flag)
             mapping = FontEncMapFind(encoding_name,
                                      FONT_ENCODING_UNICODE, 0, 0, NULL);
-- 
2.22.1

