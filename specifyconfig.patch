From 797fb8f0e1e67265f4139d397bc9b64d4fbe0d47 Mon Sep 17 00:00:00 2001
From: Caleb Johnson <me@calebj.io>
Date: Sun, 6 Dec 2015 05:52:27 -0600
Subject: [PATCH] Allow specifying config.ini directory

---
 code/src/java/pcgen/system/Main.java | 20 +++++++++++++++++++-
 1 file changed, 19 insertions(+), 1 deletion(-)

diff --git a/code/src/java/pcgen/system/Main.java b/code/src/java/pcgen/system/Main.java
index 9d26b60..0996e1b 100644
--- a/code/src/java/pcgen/system/Main.java
+++ b/code/src/java/pcgen/system/Main.java
@@ -148,7 +148,7 @@ public final class Main
 				+ PCGenPropBundle.getSvnRevisionString());
 		Thread.setDefaultUncaughtExceptionHandler(new PCGenUncaughtExceptionHandler());
 		logSystemProps();
-		configFactory = new PropertyContextFactory(SystemUtils.USER_DIR);
+		configFactory = new PropertyContextFactory(getConfigPath());
 		configFactory.registerAndLoadPropertyContext(ConfigurationSettings.getInstance());
 
 		parseCommands(args);
@@ -166,6 +166,24 @@ public final class Main
 		}
 	}
 
+	static String getConfigPath()
+	{
+		String aPath;
+
+		// First see if it was specified on the command line
+		aPath = System.getProperty("pcgen.config"); //$NON-NLS-1$
+		if (aPath != null) {
+			File testPath=new File(aPath);
+			// Then make sure it's an existing folder
+			if (testPath.exists() && testPath.isDirectory())
+			{
+				return aPath;
+			}
+		}
+		// Otherwise return user dir
+		return SystemUtils.USER_DIR;
+	}
+
 	public static boolean loadCharacterAndExport(String characterFile, String exportSheet, String outputFile, String configFile)
 	{
 		Main.characterFile = characterFile;
-- 
2.6.3

