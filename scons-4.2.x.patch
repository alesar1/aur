From bdfaeaa09501f520953372e4d6043c9dad533c79 Mon Sep 17 00:00:00 2001
From: Petteri Aimonen <jpa@git.mail.kapsi.fi>
Date: Mon, 2 Aug 2021 17:28:45 +0300
Subject: [PATCH] Fix problems running tests with newer SCons version
 (deprecated env.has_key())

---
 tests/fuzztest/SConscript             | 6 +++---
 tests/site_scons/site_init.py         | 6 +++---
 tests/site_scons/site_tools/nanopb.py | 8 ++++----
 3 files changed, 10 insertions(+), 10 deletions(-)

diff --git a/tests/fuzztest/SConscript b/tests/fuzztest/SConscript
index 7c0d6e2..a5df905 100644
--- a/tests/fuzztest/SConscript
+++ b/tests/fuzztest/SConscript
@@ -80,12 +80,12 @@ def run_against_corpus(target, source, env):
     count = 0
     args = [str(source[0])]
 
-    if env.has_key("TEST_RUNNER"):
+    if "TEST_RUNNER" in env:
         args = [env["TEST_RUNNER"]] + args
 
-    if env.has_key("FUZZTEST_CORPUS_SAMPLESIZE"):
+    if "FUZZTEST_CORPUS_SAMPLESIZE" in env:
         samplesize = int(env["FUZZTEST_CORPUS_SAMPLESIZE"])
-    elif env.has_key("EMBEDDED"):
+    elif env.get('EMBEDDED'):
         samplesize = 100
     else:
         samplesize = 4096
diff --git a/tests/site_scons/site_init.py b/tests/site_scons/site_init.py
index ce8f7e1..676b0fb 100644
--- a/tests/site_scons/site_init.py
+++ b/tests/site_scons/site_init.py
@@ -32,15 +32,15 @@ def add_nanopb_builders(env):
         else:
             infile = None
         
-        if env.has_key("COMMAND"):
+        if "COMMAND" in env:
             args = [env["COMMAND"]]
         else:
             args = [str(source[0])]
         
-        if env.has_key('ARGS'):
+        if 'ARGS' in env:
             args.extend(env['ARGS'])
 
-        if env.has_key("TEST_RUNNER"):
+        if "TEST_RUNNER" in env:
             args = [env["TEST_RUNNER"]] + args
         
         print('Command line: ' + str(args))
diff --git a/tests/site_scons/site_tools/nanopb.py b/tests/site_scons/site_tools/nanopb.py
index 1a25808..37b8e20 100644
--- a/tests/site_scons/site_tools/nanopb.py
+++ b/tests/site_scons/site_tools/nanopb.py
@@ -46,7 +46,7 @@ SCons.Warnings.enableWarningClass(NanopbWarning)
 
 def _detect_nanopb(env):
     '''Find the path to nanopb root directory.'''
-    if env.has_key('NANOPB'):
+    if 'NANOPB' in env:
         # Use nanopb dir given by user
         return env['NANOPB']
 
@@ -60,7 +60,7 @@ def _detect_nanopb(env):
 
 def _detect_python(env):
     '''Find Python executable to use.'''
-    if env.has_key('PYTHON'):
+    if 'PYTHON' in env:
         return env['PYTHON']
 
     p = env.WhereIs('python3')
@@ -85,7 +85,7 @@ def _detect_nanopb_generator(env):
 
 def _detect_protoc(env):
     '''Find the path to the protoc compiler.'''
-    if env.has_key('PROTOC'):
+    if 'PROTOC' in env:
         # Use protoc defined by user
         return env['PROTOC']
 
@@ -113,7 +113,7 @@ def _detect_protoc(env):
 
 def _detect_protocflags(env):
     '''Find the options to use for protoc.'''
-    if env.has_key('PROTOCFLAGS'):
+    if 'PROTOCFLAGS' in env:
         return env['PROTOCFLAGS']
 
     p = _detect_protoc(env)
-- 
2.32.0

