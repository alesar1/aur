From 5ca20a59239bc1852df5d410ca043ca6a5ea8283 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Cl=C3=A9ment=20Gallet?= <clement.gallet@ens-lyon.org>
Date: Sat, 9 Feb 2019 00:31:18 +0100
Subject: [PATCH] Fix getenv returning NULL

---
 src/program/main.cpp | 15 +++++++++++----
 1 file changed, 11 insertions(+), 4 deletions(-)

diff --git a/src/program/main.cpp b/src/program/main.cpp
index c3f04f1..f62121a 100644
--- a/src/program/main.cpp
+++ b/src/program/main.cpp
@@ -191,8 +191,11 @@ int main(int argc, char **argv)
     context.libtaspath += "/libtas.so";
 
     /* Create the working directories */
-    context.config.configdir = getenv("XDG_CONFIG_HOME");
-    if (context.config.configdir.empty()) {
+    char *path = getenv("XDG_CONFIG_HOME");
+    if (path) {
+        context.config.configdir = path;
+    }
+    else {
         context.config.configdir = getenv("HOME");
         context.config.configdir += "/.config";
     }
@@ -213,8 +216,12 @@ int main(int argc, char **argv)
     /* If the config file set custom directories for the remaining working dir,
      * we create these directories (if not already created).
      * Otherwise, we set and create the default ones. */
-    std::string data_dir = getenv("XDG_DATA_HOME");
-    if (data_dir.empty()) {
+    std::string data_dir;
+    path = getenv("XDG_DATA_HOME");
+    if (path) {
+        data_dir = path;
+    }
+    else {
         data_dir = getenv("HOME");
         data_dir += "/.local/share";
     }
-- 
2.20.1

