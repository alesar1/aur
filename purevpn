#!/bin/bash

usage() {
  cat <<EOF
usage: ${0##*/} [OPTION]

Options:
    -h            Print this help message
    -u [username] Set the username
    -p [password] Set the password

If 'OPTION' is unspecified, ${0##*/} will not make any changes.

EOF
}

while getopts "hu:p:" opt
  do
    case $opt in
      h) 
        usage
        exit 0
        ;;
      u)
        uname=$OPTARG
        ;;
      p) 
        passw=$OPTARG
	;;
      \?)
        usage
        exit 1
        ;;
    esac
  done

if [ -z "$uname" ] && [ -z "$passw"]; then 
  echo "Neither user nor password were specified. Nothing to do!"
  usage
  exit 1; 
fi

echo "Updating configuration files"
cd /etc/NetworkManager/system-connections
find *-PUREVPN -print0 | while read -d $'\0' file
do
  sed -i "s/\busername=.*/username=${uname}/g" "$file" #username
  sed -i "s/\bpassword=.*/password=${passw}/g" "$file" #username
done
echo "done"
echo "Restarting NetworkManager"
systemctl restart NetworkManager

