#!/usr/bin/openrc-run
description="Set FbConDecor backgrounds"


depend() {

	# Make sure fbcondecor is up after xdm starts any dm
	after consolefont
	before elogind
}

start ()
{
. /etc/rc.d/functions.d/fbsplash-basic.sh
. /etc/conf.d/fbcondecor
. /usr/bin/splash-functions.sh
retval=0
[ -z "${SPLASH_TTYS%% }" ] && retval=1
	if [ "${SPLASH_MODE_REQ}" != "off" ]; then
		ebegin "Setting FBconDecor console images"
		for tty in ${SPLASH_TTYS}; do
			# avoid blinking on boot
			[[ "$( fbcondecor_ctl --tty=${tty} -c getstate )" == *\ on ]] && continue
			fbcondecor_set_theme ${SPLASH_THEME} ${tty} || sleep 5 || retval=1
		done
	eend $?
	fi
}
stop ()
{
	ebegin "Disabling FBconDecor console images"
	for tty in ${SPLASH_TTYS}; do
		# avoid errors on restart
		[[ "$( fbcondecor_ctl --tty=${tty} -c getstate )" == *\ off ]] && continue
		fbcondecor_ctl --tty=${tty} -c off || retval=1
	done
	eend $?
}


