From 6ab3a40666106c77e0685bf6053f53a2878cc85b Mon Sep 17 00:00:00 2001
From: "Eric S. Raymond" <esr@thyrsus.com>
Date: Thu, 10 Jun 2021 05:47:05 -0400
Subject: [PATCH 1/2] Attempt at fixing GitLab issue #362: incremental
 mirror...

...fails because of SVN error.
---
 tool/repotool.go | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/tool/repotool.go b/tool/repotool.go
index 376696e3..9145f9d4 100644
--- a/tool/repotool.go
+++ b/tool/repotool.go
@@ -479,6 +479,12 @@ func mirror(args []string) {
 	password := os.Getenv("RPASSWORD")
 	// Gets commit length of a repo from its URL
 	reposize := func(operand string) int {
+		if !strings.HasPrefix(operand, "svn://") && !strings.HasPrefix(operand, "file://") {
+			if operand[0] != '/' {
+				operand = "/" + operand
+			}
+			operand = "file://"
+		}
 		infoCredentials := ""
 		if username != "" {
 			infoCredentials = fmt.Sprintf("--username %q", username)
-- 
2.32.0

