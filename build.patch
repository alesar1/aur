--- a/Makefile	2020-06-23 12:58:20.036488630 +0300
+++ b/Makefile	2020-06-23 13:01:04.593152669 +0300
@@ -53,8 +53,8 @@
 
 # Compile with debug flags if requested.
 ifeq ($(DEBUG_JUJU), 1)
-    COMPILE_FLAGS = -gcflags "all=-N -l"
-    LINK_FLAGS = -ldflags "-X $(PROJECT)/version.GitCommit=$(GIT_COMMIT) -X $(PROJECT)/version.GitTreeState=$(GIT_TREE_STATE) -X $(PROJECT)/version.build=$(JUJU_BUILD_NUMBER)"
+    COMPILE_FLAGS = -gcflags "all=-N -l" -trimpath -gccgoflags "$(CFLAGS)
+    LINK_FLAGS = -ldflags "-extldflags '$(LDFLAGS)' -X $(PROJECT)/version.GitCommit=$(GIT_COMMIT) -X $(PROJECT)/version.GitTreeState=$(GIT_TREE_STATE) -X $(PROJECT)/version.build=$(JUJU_BUILD_NUMBER)"
 else
 ifeq ($(shell go env GOARCH | sed -E 's/.*(ppc64le|ppc64).*/golang/'), golang)
 	# disable optimizations on ppc64le due to https://golang.org/issue/39049
