diff --git a/src/Makefile.am b/src/Makefile.am
index 9d1ba86..e029bac 100644
--- a/src/Makefile.am
+++ b/src/Makefile.am
@@ -34,8 +34,10 @@ snarfcppopts = $(DEFS) $(INCLUDES) $(CPPFLAGS) $(AM_CPPFLAGS) \
 # Token reader lookup.
 token-reader-lookup.c: $(srcdir)/token-readers.h
 	$(AM_V_GEN) LC_ALL=C ; export LC_ALL ; cat $< |	\
-	$(srcdir)/extract-token-readers.sh | \
-	$(GPERF) -t -C -N _scm_token_reader_lookup > $@
+	$(srcdir)/extract-token-readers.sh |		\
+	$(GPERF) -t -C -N _scm_token_reader_lookup |	\
+	$(SED) -e's/register //g' > "$@.tmp"
+	mv "$@.tmp" "$@"
 
 token-reader-list.c: $(srcdir)/token-readers.h
 	$(AM_V_GEN) LC_ALL=C ; export LC_ALL ; cat $< | \
@@ -44,6 +46,8 @@ token-reader-list.c: $(srcdir)/token-readers.h
 
 # `make-reader' flags.
 make-reader-flags.c: $(srcdir)/reader.h
-	$(AM_V_GEN) LC_ALL=C ; export LC_ALL ; cat $< | \
-	$(srcdir)/extract-make-reader-flags.sh | \
-	$(GPERF) -t -C -N _scm_to_make_reader_flag > $@
+	$(AM_V_GEN) LC_ALL=C ; export LC_ALL ; cat $< |	\
+	$(srcdir)/extract-make-reader-flags.sh |	\
+	$(GPERF) -t -C -N _scm_to_make_reader_flag |	\
+	$(SED) -e's/register //g' > "$@.tmp"
+	mv "$@.tmp" "$@"
diff --git a/src/reader.c b/src/reader.c
index b74b661..0dd0771 100644
--- a/src/reader.c
+++ b/src/reader.c
@@ -1,6 +1,6 @@
 /* A Scheme reader compiler for Guile.
 
-   Copyright (C) 2005, 2006, 2007, 2008, 2012, 2016 Ludovic Courtès <ludo@gnu.org>
+   Copyright (C) 2005, 2006, 2007, 2008, 2012, 2016, 2018 Ludovic Courtès <ludo@gnu.org>
 
    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
@@ -1940,7 +1940,7 @@ scm_to_reader (SCM reader)
 struct scm_reader_flag_entry;
 
 const struct scm_reader_flag_entry *
-_scm_to_make_reader_flag (const char *, unsigned int);
+_scm_to_make_reader_flag (const char *, size_t);
 
 /* Include the automatically-generated perfect hash function.  */
 #include "make-reader-flags.c"
diff --git a/src/token-readers.c b/src/token-readers.c
index c0a9057..811e635 100644
--- a/src/token-readers.c
+++ b/src/token-readers.c
@@ -1139,7 +1139,7 @@ scm_read_skribe_exp (scm_t_wchar chr, SCM port, scm_reader_t reader,
 /* Directory of standard token readers.  */
 
 extern const struct scm_token_reader_entry *
-_scm_token_reader_lookup (const char *, unsigned int);
+_scm_token_reader_lookup (const char *, size_t);
 
 #include <string.h>
 #include "token-reader-lookup.c"
