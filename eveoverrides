#!/bin/sh

EVECONF=$HOME/.config/CCP/EVE.conf
EVEDIR=$HOME/.local/lib/EVE

UCW=$(grep UseCustomWine $EVECONF | cut -d= -f2)
if [ "x$UCW" = "xtrue" ]; then
    WINEPATH=$(grep CustomWinePath $EVECONF | cut -d= -f2)
    WINEPATH=${WINEPATH%/*}
else
    WINEPATH=$EVEDIR/SharedCache/wine/bin
fi

env WINEPREFIX=$EVEDIR/SharedCache/wineenv \
    WINEDEBUG=-all \
    WINEDLLOVERRIDES="mscoree,mshtml,winemenubuilder.exe=d" \
    $WINEPATH/wine reg add \
    'HKEY_CURRENT_USER\Software\Wine\DllOverrides' \
    /v winemenubuilder.exe /f
[ -x "$(which notify-send)" ] && \
    notify-send -u low -i eve "Wine overrides applied."
