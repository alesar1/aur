# https://github.com/cytle/wechat_web_devtools/issues/293#issuecomment-604623774

diff -ur "a/$APPDATA/Tencent/\345\276\256\344\277\241\345\274\200\345\217\221\350\200\205\345\267\245\345\205\267/package.nw/js/core/index.js" "b/$APPDATA/Tencent/\345\276\256\344\277\241\345\274\200\345\217\221\350\200\205\345\267\245\345\205\267/package.nw/js/core/index.js"
--- "a/$APPDATA/Tencent/\345\276\256\344\277\241\345\274\200\345\217\221\350\200\205\345\267\245\345\205\267/package.nw/js/core/index.js"	2020-04-02 14:49:30.000000000 +0800
+++ "b/$APPDATA/Tencent/\345\276\256\344\277\241\345\274\200\345\217\221\350\200\205\345\267\245\345\205\267/package.nw/js/core/index.js"	2020-05-24 15:41:01.326086004 +0800
@@ -1 +1,33 @@
-'use strict';require('../js/unpack/hackrequire/index.js');const CORE_PATH='../core.wxvpkg',tools=require(CORE_PATH + '/84b183688a46c9e2626d3e6f83365e13.js'),locales=require(CORE_PATH + '/2ecd9245a65446da4e50831e85e3b27f.js'),isMac='darwin'===process.platform;function initGlobal(){const a=require(CORE_PATH + '/9172561b0b10d8ce715be906748879d7.js');a.initGlobal(global,nw.Window.get()),a.preventDefault(document),a.initCli(global);const b=global.Win;if(global.windowMap.set('LOGIN',b),b.on('close',()=>{const a=require(CORE_PATH + '/881e653f19d837f2408386047cb8c38c.js');a.notifyCloseWindow(),setTimeout(()=>{b.close(!0)},1e3)}),Object.defineProperties(global.worker,{bbsLogWorker:{get(){return this._bbsLogWoker||(this._bbsLogWoker=new Worker('../js/unpack/workers/bbslog.js')),this._bbsLogWoker}}}),location.search){const a=tools.getQuery(location.search);global.runtimeId=a.runtimeid||'0',global.isDevWindow=!0;const b=location.search.match(/devtype=(.*?)(&|$)/);switch(global.devType=b&&b[1],global.devType){case'webdebugger':{global.devInfo.id=a.devid;break}default:{if(global.devInfo.id=a.devid,global.devInfo.appid=a.appid,global.devInfo.projectname=a.projectname,global.devInfo.projectpath=a.projectpath,global.devInfo.projectid=encodeURIComponent(decodeURIComponent(a.projectid)),a.autoPort){const b=require(CORE_PATH + '/1a8839d0d7fe5d5556bc9fc87da0c369.js').default;b.start(+a.autoPort)}if(global.devInfo.isTemp=!!a.isTemp,global.devInfo.isOnline=!!a.isOnline,global.devInfo.isTemp){const a=`temp_${global.devInfo.appid}_${global.devInfo.projectname}`;global.devInfo.project=JSON.parse(localStorage[a]),delete localStorage[a]}}}if(a.simple){console.error(a),global.isSimple=!0,global.userInfo=JSON.parse(a.userinfo);try{a.testuserinfo&&(global.testUserInfo=JSON.parse(a.testuserinfo),console.error(global.testUserInfo))}catch(a){console.error(a)}}}}function initMenu(){tools.setPageLoadingTitle(locales.config.LOADING_TITLE),tools.setPageLoading(locales.config.LOADING_INIT_MENU);try{if(global.isDevWindow||isMac){const a=new nw.Menu({type:'menubar'}),b=new nw.Menu,c=new nw.Menu;c.append(new nw.MenuItem({label:locales.config.MENU_INSPECT_APP,click:()=>global.Win.showDevTools()})),b.append(new nw.MenuItem({label:locales.config.MENU_INSPECT,submenu:c})),b.append(new nw.MenuItem({label:locales.config.CLOSE_WINDOW,click:()=>global.Win.close(!0)})),b.append(new nw.MenuItem({label:locales.config.MENU_EXIT,click:()=>nw.App.quit()})),a.append(new nw.MenuItem({label:locales.config.MENU_TITLE_APP,submenu:b})),global.Win.menu=a}}catch(a){}}function correctWindowPos(){function a(a){return c+e>a.x&&c<a.x+a.width&&d>a.y&&d<a.y+a.height}const{Win:b}=global,c=b.x,d=b.y,e=b.width,f=[];nw.Screen.screens.forEach((a)=>f.push(a.work_area));let g=!1;for(let b=0,c=f.length;b<c;b++)if(a(f[b])){g=!0;break}g||function(a){(c+e<a.x||c>a.x+a.width)&&(b.x=a.x),(d<a.y||d>a.y+a.height)&&(b.y=a.y)}(f[0])}const init=()=>{initGlobal(),initMenu(),'win32'===process.platform&&correctWindowPos();let a;if(global.isSimple)a=require(CORE_PATH + '/8524207e9ea0bd06cec5e97c74bd6b7d.js');else{const b=require(CORE_PATH + '/5f3c86137d346ddffec99d08c1ac2bb0.js').default;b.start(),a=require(CORE_PATH + '/29cbb96f0d87ca0a3ee63c5dbbd8107c.js')}'complete'===global.contentDocument.readyState?a.launch():global.contentWindow.addEventListener('load',a.launch)};init(),module.exports={};
\ No newline at end of file
+const oldMenuAppend = nw.Menu.prototype.append
+const oldMenuInsert = nw.Menu.prototype.insert
+function isSeparator(menu_item) {
+  return menu_item && menu_item.type === 'separator'
+}
+nw.Menu.prototype.append = function (menu_item) {
+  const items = this.items
+  const len = this.items.length
+  if (~items.indexOf(menu_item)) return
+  if (len === 0 && isSeparator(menu_item)) {
+    return menu_item._destroy()
+  }
+  if (!isSeparator(menu_item) || !isSeparator(items[len - 1])) {
+    oldMenuAppend.call(this, menu_item)
+  } else {
+    return menu_item._destroy()
+  }
+}
+nw.Menu.prototype.insert = function (menu_item, i) {
+  const items = this.items
+  const len = this.items.length
+  if (~items.indexOf(menu_item)) return
+  if (len === 0 && isSeparator(menu_item)) {
+    return menu_item._destroy()
+  }
+  if (!isSeparator(menu_item) || (!isSeparator(items[i]) && !isSeparator(items[i - 1]))) {
+    oldMenuInsert.call(this, menu_item)
+  } else {
+    return menu_item._destroy()
+  }
+}
+
+'use strict';require('../js/unpack/hackrequire/index.js');const CORE_PATH='../core.wxvpkg',tools=require(CORE_PATH + '/84b183688a46c9e2626d3e6f83365e13.js'),locales=require(CORE_PATH + '/2ecd9245a65446da4e50831e85e3b27f.js'),isMac='darwin'===process.platform;function initGlobal(){const a=require(CORE_PATH + '/9172561b0b10d8ce715be906748879d7.js');a.initGlobal(global,nw.Window.get()),a.preventDefault(document),a.initCli(global);const b=global.Win;if(global.windowMap.set('LOGIN',b),b.on('close',()=>{const a=require(CORE_PATH + '/881e653f19d837f2408386047cb8c38c.js');a.notifyCloseWindow(),setTimeout(()=>{b.close(!0)},1e3)}),Object.defineProperties(global.worker,{bbsLogWorker:{get(){return this._bbsLogWoker||(this._bbsLogWoker=new Worker('../js/unpack/workers/bbslog.js')),this._bbsLogWoker}}}),location.search){const a=tools.getQuery(location.search);global.runtimeId=a.runtimeid||'0',global.isDevWindow=!0;const b=location.search.match(/devtype=(.*?)(&|$)/);switch(global.devType=b&&b[1],global.devType){case'webdebugger':{global.devInfo.id=a.devid;break}default:{if(global.devInfo.id=a.devid,global.devInfo.appid=a.appid,global.devInfo.projectname=a.projectname,global.devInfo.projectpath=a.projectpath,global.devInfo.projectid=encodeURIComponent(decodeURIComponent(a.projectid)),a.autoPort){const b=require(CORE_PATH + '/1a8839d0d7fe5d5556bc9fc87da0c369.js').default;b.start(+a.autoPort)}if(global.devInfo.isTemp=!!a.isTemp,global.devInfo.isOnline=!!a.isOnline,global.devInfo.isTemp){const a=`temp_${global.devInfo.appid}_${global.devInfo.projectname}`;global.devInfo.project=JSON.parse(localStorage[a]),delete localStorage[a]}}}if(a.simple){console.error(a),global.isSimple=!0,global.userInfo=JSON.parse(a.userinfo);try{a.testuserinfo&&(global.testUserInfo=JSON.parse(a.testuserinfo),console.error(global.testUserInfo))}catch(a){console.error(a)}}}}function initMenu(){tools.setPageLoadingTitle(locales.config.LOADING_TITLE),tools.setPageLoading(locales.config.LOADING_INIT_MENU);try{if(global.isDevWindow||isMac){const a=new nw.Menu({type:'menubar'}),b=new nw.Menu,c=new nw.Menu;c.append(new nw.MenuItem({label:locales.config.MENU_INSPECT_APP,click:()=>global.Win.showDevTools()})),b.append(new nw.MenuItem({label:locales.config.MENU_INSPECT,submenu:c})),b.append(new nw.MenuItem({label:locales.config.CLOSE_WINDOW,click:()=>global.Win.close(!0)})),b.append(new nw.MenuItem({label:locales.config.MENU_EXIT,click:()=>nw.App.quit()})),a.append(new nw.MenuItem({label:locales.config.MENU_TITLE_APP,submenu:b})),global.Win.menu=a}}catch(a){}}function correctWindowPos(){function a(a){return c+e>a.x&&c<a.x+a.width&&d>a.y&&d<a.y+a.height}const{Win:b}=global,c=b.x,d=b.y,e=b.width,f=[];nw.Screen.screens.forEach((a)=>f.push(a.work_area));let g=!1;for(let b=0,c=f.length;b<c;b++)if(a(f[b])){g=!0;break}g||function(a){(c+e<a.x||c>a.x+a.width)&&(b.x=a.x),(d<a.y||d>a.y+a.height)&&(b.y=a.y)}(f[0])}const init=()=>{initGlobal(),initMenu(),'win32'===process.platform&&correctWindowPos();let a;if(global.isSimple)a=require(CORE_PATH + '/8524207e9ea0bd06cec5e97c74bd6b7d.js');else{const b=require(CORE_PATH + '/5f3c86137d346ddffec99d08c1ac2bb0.js').default;b.start(),a=require(CORE_PATH + '/29cbb96f0d87ca0a3ee63c5dbbd8107c.js')}'complete'===global.contentDocument.readyState?a.launch():global.contentWindow.addEventListener('load',a.launch)};init(),module.exports={};
