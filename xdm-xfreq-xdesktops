#!/bin/sh

if [[ $# > 0 && $# <3 ]]; then
	if [[ $# == 2 ]]; then
		X=$2
	fi
	P=$1
	if [[ $P && -d $P ]]; then
		I=1

		if [[ $X == $I ]]; then
			G="xlogin*greeting: [F1] (XSession)\\040\\040\\040"
		else
			G="xlogin*greeting: [F1] XSession\\040\\040\\040"
		fi
		echo "xlogin*login.translations: #override \\" > /var/run/xdm-xfreq-xdesktops
		echo "    Ctrl<Key>R: restart-session()\n\\" >> /var/run/xdm-xfreq-xdesktops
		echo "    <Key>F1: set-session-argument() finish-field()\n\\" >> /var/run/xdm-xfreq-xdesktops

		for D in $P/*.desktop
		do
			I=$((I + 1))
			N=`grep "Name=" $D | cut -d "=" -f 2`
			R=`grep -w "Exec" $D | cut -d "=" -f 2`
			if [[ $X == $I ]]; then
				A=$R
				G=$G"[F$I] ($N)\\040\\040\\040"
			else
				G=$G"[F$I] $N\\040\\040\\040"
			fi
			echo "    <Key>F${I}: set-session-argument(${R}) finish-field()\n\\" >> /var/run/xdm-xfreq-xdesktops
		done

		echo "    <Key>Delete: delete-character()\n\\" >> /var/run/xdm-xfreq-xdesktops
		echo "    <Key>Left: move-backward-character()\n\\" >> /var/run/xdm-xfreq-xdesktops
		echo "    <Key>Right: move-forward-character()\n\\" >> /var/run/xdm-xfreq-xdesktops
		echo "    <Key>Home: move-to-begining()\n\\" >> /var/run/xdm-xfreq-xdesktops
		echo "    <Key>End: move-to-end()\n\\" >> /var/run/xdm-xfreq-xdesktops
		echo "    Ctrl<Key>KP_Enter: set-session-argument(failsafe) finish-field()\n\\" >> /var/run/xdm-xfreq-xdesktops
		echo "    <Key>KP_Enter: set-session-argument() finish-field()\n\\" >> /var/run/xdm-xfreq-xdesktops
		echo "    Ctrl<Key>Return: set-session-argument(failsafe) finish-field()\n\\" >> /var/run/xdm-xfreq-xdesktops
		echo "    <Key>Return: set-session-argument($A) finish-field()" >> /var/run/xdm-xfreq-xdesktops
		echo "" >> /var/run/xdm-xfreq-xdesktops
		echo $G >> /var/run/xdm-xfreq-xdesktops
	fi
fi
