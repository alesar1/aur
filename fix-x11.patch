Description: Fix for Cmake unable to find X11::X11.
Author: Arun Kumar Pariyar <openarungeek@gmail.com>
Last-Update: 2021-09-28
---

Index: dde-kwin/deepin-wm-dbus/CMakeLists.txt
===================================================================
--- dde-kwin.orig/deepin-wm-dbus/CMakeLists.txt	2021-09-29 03:36:35.000000000 +0545
+++ dde-kwin/deepin-wm-dbus/CMakeLists.txt	2021-09-29 03:36:35.000000000 +0545
@@ -8,6 +8,7 @@
 find_package(KF5GlobalAccel REQUIRED)
 find_package(DtkCore REQUIRED)
 find_package(PkgConfig REQUIRED)
+find_package(X11 REQUIRED)

 option(DISABLE_DEEPIN_WM "disable compatibility with deepin-wm" OFF)

@@ -64,6 +65,7 @@
     Qt5::DBus
     KF5::ConfigCore
     KF5::WindowSystem
+    X11::X11
     KF5::GlobalAccel
     dtkcore
     ${GSETTINGS_LDFLAGS}
Index: dde-kwin/plugins/kdecoration/CMakeLists.txt
===================================================================
--- dde-kwin.orig/plugins/kdecoration/CMakeLists.txt	2021-09-29 03:36:35.000000000 +0545
+++ dde-kwin/plugins/kdecoration/CMakeLists.txt	2021-09-29 03:36:35.000000000 +0545
@@ -7,7 +7,7 @@
 find_package(KF5Config REQUIRED)
 find_package(KF5WindowSystem REQUIRED)
 find_package(KDecoration2 REQUIRED)
-
+find_package(X11 REQUIRED)
 include_directories(${Qt5Core_PRIVATE_INCLUDE_DIRS})
 include_directories(${Qt5Gui_PRIVATE_INCLUDE_DIRS})

@@ -32,6 +32,7 @@
     ${TARGET_NAME}
     PUBLIC
     Qt5::Core
+    X11::X11
     PRIVATE
     KDecoration2::KDecoration
     KF5::CoreAddons
Index: dde-kwin/plugins/kwineffects/CMakeLists.txt
===================================================================
--- dde-kwin.orig/plugins/kwineffects/CMakeLists.txt	2021-09-29 03:36:35.000000000 +0545
+++ dde-kwin/plugins/kwineffects/CMakeLists.txt	2021-09-29 03:36:35.000000000 +0545
@@ -1,7 +1,7 @@
 find_package(Qt5 CONFIG REQUIRED COMPONENTS Core Gui)
 find_package(KF5CoreAddons REQUIRED)
 find_package(KF5WindowSystem REQUIRED)
-
+find_package(X11 REQUIRED)
 set(INSTALL_PATH "${QT_INSTALL_PLUGINS}/kwin/effects/plugins")

 add_subdirectory(scissor-window)
Index: dde-kwin/plugins/kwineffects/blur/CMakeLists.txt
===================================================================
--- dde-kwin.orig/plugins/kwineffects/blur/CMakeLists.txt	2021-09-29 03:36:35.000000000 +0545
+++ dde-kwin/plugins/kwineffects/blur/CMakeLists.txt	2021-09-29 03:36:35.000000000 +0545
@@ -1,6 +1,7 @@
 set(TARGET_NAME "blur")

 find_package(KF5Config REQUIRED)
+find_package(X11 REQUIRED)

 add_library(
     ${TARGET_NAME} MODULE
@@ -16,6 +17,7 @@
     PUBLIC
     Qt5::Core
     Qt5::Gui
+    X11::X11
     PRIVATE
     KF5::CoreAddons
     KF5::WindowSystem
Index: dde-kwin/plugins/kwineffects/multitasking/CMakeLists.txt
===================================================================
--- dde-kwin.orig/plugins/kwineffects/multitasking/CMakeLists.txt	2021-09-29 03:36:35.000000000 +0545
+++ dde-kwin/plugins/kwineffects/multitasking/CMakeLists.txt	2021-09-29 03:36:35.000000000 +0545
@@ -6,6 +6,7 @@
 set(KF5_DEP_VERSION "5.54.0") # handled by release scripts

 find_package(ECM 5.54.0  NO_MODULE)
+find_package(X11 REQUIRED)

 set(CMAKE_MODULE_PATH ${ECM_MODULE_PATH} ${ECM_KDE_MODULE_DIR})

@@ -22,7 +23,9 @@
 endif()

 #optional features
-find_package(X11 MODULE)
+message(STATUS "X11_FOUND = ${X11_FOUND}")
+message(STATUS "X11_INCLUDE_DIR = ${X11_INCLUDE_DIR}")
+message(STATUS "X11_LIBRARIES = ${X11_LIBRARIES}")
 set_package_properties(X11 PROPERTIES DESCRIPTION "X11 libraries"
                        URL "http://www.x.org"
                        TYPE OPTIONAL
@@ -32,6 +35,10 @@
                        URL "http://xcb.freedesktop.org"
                        TYPE OPTIONAL
                       )
+
+message(STATUS "XCB_XCB_FOUND = ${XCB_XCB_FOUND}")
+message(STATUS "XCB_LIBRARIES = ${XCB_LIBRARIES}")
+
 if(X11_FOUND AND XCB_XCB_FOUND)
   set(HAVE_X11 1)
   find_package(Qt5 REQUIRED NO_MODULE COMPONENTS X11Extras)
@@ -104,6 +111,7 @@
     Qt5::Widgets
     Qt5::Quick
     Qt5::QuickWidgets
+    X11::X11
     PRIVATE
     KF5::ConfigCore
     KF5::CoreAddons
Index: dde-kwin/plugins/kwineffects/scissor-window/CMakeLists.txt
===================================================================
--- dde-kwin.orig/plugins/kwineffects/scissor-window/CMakeLists.txt	2021-09-29 03:36:35.000000000 +0545
+++ dde-kwin/plugins/kwineffects/scissor-window/CMakeLists.txt	2021-09-29 03:36:49.000000000 +0545
@@ -1,4 +1,5 @@
 set(TARGET_NAME "scissor-window")
+find_package(X11 REQUIRED)

 add_library(
     ${TARGET_NAME} MODULE
@@ -9,12 +10,13 @@

 target_link_libraries(
     ${TARGET_NAME}
-    PUBLIC
-    Qt5::Core
-    Qt5::Gui
     PRIVATE
     KF5::CoreAddons
     KF5::WindowSystem
+    PUBLIC
+    Qt5::Core
+    Qt5::Gui
+    X11::X11
 )

 option(DISABLE_LIB_KWIN_XCB "Don't use libkwin-xcb" OFF)
Index: dde-kwin/plugins/platforms/lib/CMakeLists.txt
===================================================================
--- dde-kwin.orig/plugins/platforms/lib/CMakeLists.txt	2021-09-29 03:36:35.000000000 +0545
+++ dde-kwin/plugins/platforms/lib/CMakeLists.txt	2021-09-29 03:36:35.000000000 +0545
@@ -6,13 +6,15 @@
 find_package(KF5Config REQUIRED)
 find_package(KF5WindowSystem REQUIRED)
 find_package(KF5CoreAddons REQUIRED)
-
+find_package(X11)
 if (${KF5WindowSystem_VERSION_MINOR} GREATER 45)
     add_definitions(-DKWINDOWSYSTEM_NO_QWIDGET)
 else()
     find_package(Qt5Widgets REQUIRED)
 endif()

+link_libraries(${X11_LIBRARIES})
+
 add_library(
     ${TARGET_NAME} SHARED
     kwinutils.cpp
@@ -33,6 +35,7 @@
     KF5::ConfigCore
     KF5::WindowSystem
     KF5::CoreAddons
+    X11::X11
 )

 if (KWIN_LIBRARY_PATH)
Index: dde-kwin/plugins/platforms/plugin/CMakeLists.txt
===================================================================
--- dde-kwin.orig/plugins/platforms/plugin/CMakeLists.txt	2021-09-29 03:36:35.000000000 +0545
+++ dde-kwin/plugins/platforms/plugin/CMakeLists.txt	2021-09-29 03:36:35.000000000 +0545
@@ -10,6 +10,7 @@
 find_package(Qt5DBus REQUIRED)
 find_package(Qt5Widgets REQUIRED)
 find_package(DtkGui REQUIRED)
+find_package(X11)

 include_directories(${Qt5Core_PRIVATE_INCLUDE_DIRS})
 include_directories(${Qt5Gui_PRIVATE_INCLUDE_DIRS})
@@ -40,6 +41,7 @@
     org.kde.kwin.KWinUtils.xml
 )

+link_libraries(${X11_LIBRARIES})
 # for xcb platform
 add_library(
     ${TARGET_NAME} MODULE
@@ -63,6 +65,7 @@
     Qt5::Widgets
     ${DtkGui_LIBRARIES}
     kwin-xcb
+    X11::X11
 )

 # for wayland platform

