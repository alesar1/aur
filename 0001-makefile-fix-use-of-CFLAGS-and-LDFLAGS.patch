From 9ab1a97d9243ec6fa4e0bc8c3fff2cdefccebce7 Mon Sep 17 00:00:00 2001
From: Jan Samek <samekh@email.cz>
Date: Tue, 19 May 2020 22:23:30 +0200
Subject: [PATCH] makefile: fix use of CFLAGS and LDFLAGS

---
 makefile | 10 ++++------
 1 file changed, 4 insertions(+), 6 deletions(-)

diff --git a/makefile b/makefile
index acf8a13..984db82 100755
--- a/makefile
+++ b/makefile
@@ -4,8 +4,9 @@
 #
 
 PROGRAM = dpcmd
-CC      = gcc
-CFLAGS  = -Os -Wall -lpthread 
+FEATURE_LIBS += -lusb -lpthread
+CFLAGS  = -O2 -Wall
+LDFLAGS = -z muldefs $(FEATURE_LIBS)
 
 UNAME_OS := $(shell lsb_release -si)
 
@@ -13,13 +14,10 @@ ifneq ($(UNAME_OS),Ubuntu)
      CFLAGS+=-D_NON_UBUNTU
 endif
 
-FEATURE_LIBS += -lusb -lpthread
 PROGRAMMER_OBJS += dpcmd.o usbdriver.o FlashCommand.o SerialFlash.o parse.o board.o project.o IntelHexFile.o MotorolaFile.o
 
-
 $(PROGRAM): $(PROGRAMMER_OBJS)
-	$(CC) $(CFLAGS) -o $(PROGRAM) $(PROGRAMMER_OBJS) $(FEATURE_LIBS)
-
+	$(CC) $(LDFLAGS) $(PROGRAMMER_OBJS) -o $@
 
 clean:
 	rm -f $(PROGRAM) $(PROGRAM).exe *.o *.d *.c~ *.h~ *~
-- 
2.26.2

