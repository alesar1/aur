From 060c2bb9f84071246a69af49ee3dee90f8524cba Mon Sep 17 00:00:00 2001
From: Peng Wu <alexepico@gmail.com>
Date: Wed, 9 Oct 2019 14:20:22 +0800
Subject: [PATCH] Improve guess font size when read bitmap font

---
 read.c | 12 ++++++------
 1 file changed, 6 insertions(+), 6 deletions(-)

diff --git a/read.c b/read.c
index 632c7e7..915fa86 100644
--- a/read.c
+++ b/read.c
@@ -238,20 +238,20 @@ readFile(char *filename, FontPtr font)
         if(verbose_flag)
             fprintf(stderr, "size %d: %dx%d\n",
                     i, 
-                    (int)(face->available_sizes[i].x_ppem >> 6), 
-                    (int)(face->available_sizes[i].y_ppem >> 6));
+                    (int)((face->available_sizes[i].x_ppem + 32) >> 6),
+                    (int)((face->available_sizes[i].y_ppem + 32) >> 6));
 
         rc = FT_Set_Pixel_Sizes(face,
-                                face->available_sizes[i].x_ppem >> 6,
-                                face->available_sizes[i].y_ppem >> 6);
+                                (face->available_sizes[i].x_ppem + 32) >> 6,
+                                (face->available_sizes[i].y_ppem + 32) >> 6);
         if(rc != 0) {
             fprintf(stderr, "Couldn't set size.\n");
             return -1;
         }
 
         strike = makeStrike(font, 
-                            face->available_sizes[i].x_ppem >> 6,
-                            face->available_sizes[i].y_ppem >> 6);
+                            (face->available_sizes[i].x_ppem + 32) >> 6,
+                            (face->available_sizes[i].y_ppem + 32) >> 6);
         if(strike == NULL) {
             fprintf(stderr, "Couldn't allocate strike.\n");
             return -1;
-- 
2.22.0

