stages:
  - test
  - build

pamac_test:
  stage: test
  image: docker.io/archlinux:latest
  before_script:
    - pacman -Sy --noconfirm namcap
  script:
    - namcap PKGBUILD

makepkg_build:
  stage: build
  image: docker.io/archlinux:latest
  before_script:
    - pacman -Sy --noconfirm sudo base-devel git
    - useradd builduser -m && passwd -d builduser && printf 'builduser ALL=(ALL) ALL\n' | tee -a /etc/sudoers
    - sudo -u builduser bash -c 'cd ~ && git clone https://aur.archlinux.org/appimagelauncher.git && cd appimagelauncher && makepkg -si --noconfirm'
    - pacman -Rdd --noconfirm git
  script:
    - sudo -u builduser bash -c 'makepkg -si --noconfirm'
  artifacts:
    paths:
      - "*.zst"
