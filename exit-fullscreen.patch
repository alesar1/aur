Subject: Exit fullscreen mode on quit
From: Dan Carpenter <error27@gmail.com>
Date: Tue, 17 Jan 2006 08:37:51 -0800

See http://bugs.debian.org/338705

--- a/globals.h
+++ b/globals.h
@@ -344,6 +344,7 @@ void register_mask(void *pixels);
 #ifdef USE_SDL
 /* long filelength(int handle); */
 void fs_toggle();
+void exit_fullscreen();
 int intr_sysupdate();
 #endif
 
--- a/main.c
+++ b/main.c
@@ -3375,6 +3375,8 @@ void deinit_program(void)
 	__dpmi_regs regs;
 #endif
 
+	exit_fullscreen();
+
 	dj_stop();
 	dj_free_mod(MOD_MENU);
 	dj_free_mod(MOD_GAME);
--- a/sdl/gfx.c
+++ b/sdl/gfx.c
@@ -227,6 +227,13 @@ void fs_toggle()
 }
 
 
+void exit_fullscreen()
+{
+       if (fullscreen)
+               fs_toggle();
+}
+
+
 void wait_vrt(int mix)
 {
 	return;
