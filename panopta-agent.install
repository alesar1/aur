post_install() {
    # Add agent user
    if ! (id panopta-agent > /dev/null 2>&1 ); then
        useradd -r -d /usr/lib/panopta-agent -s /usr/sbin/nologin panopta-agent;
    fi
    # Change owner of needed directories to the agent user
    chown -R panopta-agent /usr/lib/panopta-agent
    chown -R panopta-agent /usr/bin/panopta-agent
    chown -R panopta-agent /var/lib/panopta-agent

    # Perform the install handshake
    python2 /usr/bin/panopta-agent/panopta_agent.py --install
}

post_upgrade() {
    post_install
}

post_remove() {
    # The agent will leave behind .pyc files, so we need to clear this out manually
    rm -rf /usr/lib/panopta-agent
    # Remove agent user
    if (id panopta-agent > /dev/null 2>&1 ); then
        userdel panopta-agent;
    fi
}
