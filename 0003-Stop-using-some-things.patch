From 2c7194e34891402aa40418b07d5a410aef608176 Mon Sep 17 00:00:00 2001
From: Connor Behan <connor.behan@gmail.com>
Date: Mon, 18 Oct 2021 18:41:16 -0400
Subject: [PATCH 3/5] Stop using some things

Specifically, GtkStock, GtkAlignment and individual H/V boxes.

Signed-off-by: Connor Behan <connor.behan@gmail.com>
---
 panel-plugin/generic-slider.c | 33 ++++++++++++++-------------------
 1 file changed, 14 insertions(+), 19 deletions(-)

diff --git a/panel-plugin/generic-slider.c b/panel-plugin/generic-slider.c
index e18207d..3ee0800 100644
--- a/panel-plugin/generic-slider.c
+++ b/panel-plugin/generic-slider.c
@@ -446,7 +446,7 @@ static void generic_slider_update_mode(GtkToggleButton *radio, Generic_Slider *g
 		return;
 	}
 	
-	hbox = gtk_widget_get_ancestor(GTK_WIDGET(radio), GTK_TYPE_HBOX);
+	hbox = gtk_widget_get_ancestor(GTK_WIDGET(radio), GTK_TYPE_BOX);
 	label = gtk_container_get_children(GTK_CONTAINER(hbox)) -> data;
 	box = gtk_widget_get_ancestor(generic_slider -> slider, GTK_TYPE_BOX);
 	gtk_widget_show_all(box);
@@ -544,7 +544,7 @@ static void generic_slider_properties_dialog(XfcePanelPlugin *plugin, Generic_Sl
 	/* We don't want the slider invoking a nonexistent command while the command is being changed */
 	generic_slider -> active = 0;
 	
-	dialog = xfce_titled_dialog_new_with_buttons(_("Generic Slider"), GTK_WINDOW(gtk_widget_get_toplevel(GTK_WIDGET(plugin))), GTK_DIALOG_DESTROY_WITH_PARENT, GTK_STOCK_CLOSE, GTK_RESPONSE_OK, NULL);
+	dialog = xfce_titled_dialog_new_with_buttons(_("Generic Slider"), GTK_WINDOW(gtk_widget_get_toplevel(GTK_WIDGET(plugin))), GTK_DIALOG_DESTROY_WITH_PARENT, _("Close"), GTK_RESPONSE_OK, NULL);
 	gtk_window_set_position(GTK_WINDOW(dialog), GTK_WIN_POS_CENTER);
 	gtk_window_set_icon_name(GTK_WINDOW(dialog), "xfce4-settings");
 	
@@ -607,10 +607,10 @@ static void generic_slider_properties_dialog(XfcePanelPlugin *plugin, Generic_Sl
 	g_signal_connect(G_OBJECT(radio_1), "toggled", G_CALLBACK(generic_slider_update_mode), generic_slider);
 	g_signal_connect(G_OBJECT(radio_2), "toggled", G_CALLBACK(generic_slider_update_mode), generic_slider);
 	g_signal_connect(G_OBJECT(radio_3), "toggled", G_CALLBACK(generic_slider_update_mode), generic_slider);
-	hbox_1 = gtk_hbox_new(FALSE, 0);
-	hbox_2 = gtk_hbox_new(FALSE, 0);
-	hbox_3 = gtk_hbox_new(FALSE, 0);
-	hbox_4 = gtk_hbox_new(FALSE, 0);
+	hbox_1 = gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 0);
+	hbox_2 = gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 0);
+	hbox_3 = gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 0);
+	hbox_4 = gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 0);
 	gtk_box_pack_start(GTK_BOX(hbox_1), label_4, FALSE, FALSE, 0);
 	gtk_box_pack_start(GTK_BOX(hbox_1), radio_1, FALSE, FALSE, 0);
 	gtk_box_pack_start(GTK_BOX(hbox_2), label_5, FALSE, FALSE, 0);
@@ -630,7 +630,7 @@ static void generic_slider_properties_dialog(XfcePanelPlugin *plugin, Generic_Sl
 	gtk_box_pack_start(GTK_BOX(hbox_4), check, FALSE, FALSE, 0);
 	gtk_container_add(GTK_CONTAINER(bbox_2), hbox_4);
 	gtk_container_add(GTK_CONTAINER(bbox_2), picker);
-	hbox_5 = gtk_hbox_new(FALSE, 0);
+	hbox_5 = gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 0);
 	frame_1 = gtk_frame_new("Show:");
 	frame_2 = gtk_frame_new("Color:");
 	gtk_container_add(GTK_CONTAINER(frame_1), bbox_1);
@@ -661,13 +661,15 @@ static void generic_slider_orientation_or_mode_changed(XfcePanelPlugin *plugin,
 	GtkWidget *aligned_box = gtk_container_get_children(GTK_CONTAINER(event_box)) -> data;
 	
 	if (vertical) {
-		gtk_alignment_set(GTK_ALIGNMENT(aligned_box), 0.5, 0.5, 0.0, 1.0);
+		gtk_widget_set_halign(aligned_box, GTK_ALIGN_CENTER);
+		gtk_widget_set_valign(aligned_box, GTK_ALIGN_FILL);
 		gtk_orientable_set_orientation(GTK_ORIENTABLE(slider), GTK_ORIENTATION_HORIZONTAL);
 		gtk_widget_set_size_request(slider, -1, WIDTH);
 		gtk_widget_set_size_request(GTK_WIDGET(plugin), xfce_panel_plugin_get_size(plugin), -1);
 		gtk_orientable_set_orientation(GTK_ORIENTABLE(box), GTK_ORIENTATION_VERTICAL);
 	} else {
-		gtk_alignment_set(GTK_ALIGNMENT(aligned_box), 0.5, 0.5, 1.0, 0.0);
+		gtk_widget_set_halign(aligned_box, GTK_ALIGN_FILL);
+		gtk_widget_set_valign(aligned_box, GTK_ALIGN_CENTER);
 		gtk_orientable_set_orientation(GTK_ORIENTABLE(slider), GTK_ORIENTATION_VERTICAL);
 		gtk_widget_set_size_request(slider, WIDTH, -1);
 		gtk_widget_set_size_request(GTK_WIDGET(plugin), -1, xfce_panel_plugin_get_size(plugin));
@@ -713,7 +715,6 @@ static gboolean generic_slider_set_size(XfcePanelPlugin *plugin, int size) {
 
 static void generic_slider_free_data(XfcePanelPlugin *plugin, Generic_Slider *generic_slider) {
 	GtkWidget *event_box;
-	GtkWidget *aligned_box;
 	GtkWidget *slider;
 	GtkWidget *label;
 	GtkWidget *box;
@@ -722,11 +723,9 @@ static void generic_slider_free_data(XfcePanelPlugin *plugin, Generic_Slider *ge
 	label = generic_slider -> label;
 	box = gtk_widget_get_ancestor(label, GTK_TYPE_BOX);
 	event_box = gtk_widget_get_ancestor(slider, GTK_TYPE_EVENT_BOX);
-	aligned_box = gtk_container_get_children(GTK_CONTAINER(event_box)) -> data;
 	
 	g_return_if_fail(plugin != NULL);
 	g_return_if_fail(event_box != NULL);
-	g_return_if_fail(aligned_box != NULL);
 	g_return_if_fail(box != NULL);
 	g_return_if_fail(slider != NULL);
 	g_return_if_fail(label != NULL);
@@ -734,7 +733,6 @@ static void generic_slider_free_data(XfcePanelPlugin *plugin, Generic_Slider *ge
 	g_object_unref(G_OBJECT(slider));
 	g_object_unref(G_OBJECT(label));
 	g_object_unref(G_OBJECT(box));
-	g_object_unref(G_OBJECT(aligned_box));
 	g_object_unref(G_OBJECT(event_box));
 	
 	if (generic_slider -> timeout_id != 0) {
@@ -757,7 +755,6 @@ static void generic_slider_construct(XfcePanelPlugin *plugin) {
 	GtkStyle *pre_rc;
 	GtkRcStyle *rc;
 	GtkWidget *event_box;
-	GtkWidget *aligned_box;
 	GtkWidget *slider;
 	GtkWidget *label;
 	GtkWidget *box;
@@ -765,7 +762,6 @@ static void generic_slider_construct(XfcePanelPlugin *plugin) {
 	char *label_text;
 	
 	event_box = gtk_event_box_new();
-	aligned_box = gtk_alignment_new(0.5, 0.5, 1.0, 1.0);
 	slider = gtk_progress_bar_new();
 	label = gtk_label_new("");
 	generic_slider -> timeout_id = 0;
@@ -792,17 +788,16 @@ static void generic_slider_construct(XfcePanelPlugin *plugin) {
 	if (xfce_panel_plugin_get_orientation(plugin) == GTK_ORIENTATION_HORIZONTAL) {
 		gtk_orientable_set_orientation(GTK_ORIENTABLE(slider), GTK_ORIENTATION_VERTICAL);
 		gtk_widget_set_size_request(slider, WIDTH, -1);
-		box = gtk_hbox_new(FALSE, 0);
+		box = gtk_box_new(GTK_ORIENTATION_HORIZONTAL, 0);
 	} else {
 		gtk_orientable_set_orientation(GTK_ORIENTABLE(slider), GTK_ORIENTATION_HORIZONTAL);
 		gtk_widget_set_size_request(slider, -1, WIDTH);
-		box = gtk_vbox_new(FALSE, 0);
+		box = gtk_box_new(GTK_ORIENTATION_VERTICAL, 0);
 	}
 	
 	gtk_box_pack_start(GTK_BOX(box), label, FALSE, FALSE, 0);
 	gtk_box_pack_start(GTK_BOX(box), slider, FALSE, FALSE, 0);
-	gtk_container_add(GTK_CONTAINER(aligned_box), box);
-	gtk_container_add(GTK_CONTAINER(event_box), aligned_box);
+	gtk_container_add(GTK_CONTAINER(event_box), box);
 	
 	xfce_panel_plugin_menu_show_configure (plugin);
 	
-- 
2.33.0

