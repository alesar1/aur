diff -rcp glibc-2.3.3.orig/glibc-2.3.3/config.make.in glibc-2.3.3/config.make.in
*** glibc-2.3.3.orig/glibc-2.3.3/config.make.in	2003-11-11 16:37:03.000000000 -0800
--- glibc-2.3.3/config.make.in	2004-10-06 23:40:56.000000000 -0700
*************** have-cpp-asm-debuginfo = @libc_cv_cpp_as
*** 55,60 ****
--- 55,61 ----
  enable-check-abi = @enable_check_abi@
  have-forced-unwind = @libc_cv_forced_unwind@
  have-fpie = @libc_cv_fpie@
+ fno-unit-at-a-time = @fno_unit_at_a_time@
  
  static-libgcc = @libc_cv_gcc_static_libgcc@
  
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/configure glibc-2.3.3/configure
*** glibc-2.3.3.orig/glibc-2.3.3/configure	2003-11-11 16:37:03.000000000 -0800
--- glibc-2.3.3/configure	2004-10-06 23:22:46.000000000 -0700
*************** ac_includes_default="\
*** 312,318 ****
  # include <unistd.h>
  #endif"
  
! ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS with_fp with_cvs enable_check_abi oldest_abi subdirs force_install all_warnings build build_cpu build_vendor build_os host host_cpu host_vendor host_os base_machine sysnames INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA LN_S CC CFLAGS LDFLAGS CPPFLAGS ac_ct_CC OBJEXT BUILD_CC cross_compiling CPP CXX CXXFLAGS ac_ct_CXX AR OBJDUMP RANLIB ac_ct_RANLIB MIG AS LD PWD_P MAKE MSGFMT MAKEINFO SED AUTOCONF CCVERSION SYSINCLUDES libc_cv_gcc_static_libgcc BASH libc_cv_have_bash2 KSH libc_cv_have_ksh AWK PERL INSTALL_INFO BISON VERSIONING libc_cv_asm_protected_directive libc_cv_initfinit_array libc_cv_z_nodelete libc_cv_z_nodlopen libc_cv_z_initfirst libc_cv_Bgroup ASFLAGS_config libc_cv_z_combreloc libc_cv_z_execstack libc_cv_fpie libc_cv_have_initfini libc_cv_cpp_asm_debuginfo no_whole_archive exceptions LIBGD EGREP sizeof_long_double libc_cv_gcc_unwind_find_fde uname_sysname uname_release uname_version old_glibc_headers libc_cv_slibdir libc_cv_localedir libc_cv_sysconfdir libc_cv_rootsbindir libc_cv_forced_unwind use_ldconfig ldd_rewrite_script gnu_ld gnu_as elf xcoff static shared pic_default profile omitfp bounded static_nss nopic_initfini DEFINES linux_doors mach_interface_list VERSION RELEASE LIBOBJS LTLIBOBJS'
  ac_subst_files=''
  
  # Initialize some variables set by options.
--- 312,318 ----
  # include <unistd.h>
  #endif"
  
! ac_subst_vars='SHELL PATH_SEPARATOR PACKAGE_NAME PACKAGE_TARNAME PACKAGE_VERSION PACKAGE_STRING PACKAGE_BUGREPORT exec_prefix prefix program_transform_name bindir sbindir libexecdir datadir sysconfdir sharedstatedir localstatedir libdir includedir oldincludedir infodir mandir build_alias host_alias target_alias DEFS ECHO_C ECHO_N ECHO_T LIBS with_fp with_cvs enable_check_abi oldest_abi subdirs force_install all_warnings build build_cpu build_vendor build_os host host_cpu host_vendor host_os base_machine sysnames INSTALL_PROGRAM INSTALL_SCRIPT INSTALL_DATA LN_S CC CFLAGS LDFLAGS CPPFLAGS ac_ct_CC OBJEXT BUILD_CC cross_compiling CPP CXX CXXFLAGS ac_ct_CXX AR OBJDUMP RANLIB ac_ct_RANLIB MIG AS LD PWD_P MAKE MSGFMT MAKEINFO SED AUTOCONF CCVERSION SYSINCLUDES libc_cv_gcc_static_libgcc BASH libc_cv_have_bash2 KSH libc_cv_have_ksh AWK PERL INSTALL_INFO BISON VERSIONING libc_cv_asm_protected_directive libc_cv_initfinit_array libc_cv_z_nodelete libc_cv_z_nodlopen libc_cv_z_initfirst libc_cv_Bgroup ASFLAGS_config libc_cv_z_combreloc libc_cv_z_execstack libc_cv_fpie fno_unit_at_a_time libc_cv_have_initfini libc_cv_cpp_asm_debuginfo no_whole_archive exceptions LIBGD EGREP sizeof_long_double libc_cv_gcc_unwind_find_fde uname_sysname uname_release uname_version old_glibc_headers libc_cv_slibdir libc_cv_localedir libc_cv_sysconfdir libc_cv_rootsbindir libc_cv_forced_unwind use_ldconfig ldd_rewrite_script gnu_ld gnu_as elf xcoff static shared pic_default profile omitfp bounded static_nss nopic_initfini DEFINES linux_doors mach_interface_list VERSION RELEASE LIBOBJS LTLIBOBJS'
  ac_subst_files=''
  
  # Initialize some variables set by options.
*************** echo "${ECHO_T}$libc_cv_fpie" >&6
*** 5449,5454 ****
--- 5449,5483 ----
  
  fi
  
+ echo "$as_me:$LINENO: checking for -fno-unit-at-a-time" >&5
+ echo $ECHO_N "checking for -fno-unit-at-a-time... $ECHO_C" >&6
+ if test "${libc_cv_fno_unit_at_a_time+set}" = set; then
+   echo $ECHO_N "(cached) $ECHO_C" >&6
+ else
+   cat > conftest.c <<EOF
+ int foo;
+ EOF
+ if { ac_try='${CC-cc} $CFLAGS $CPPFLAGS -S -fno-unit-at-a-time
+ 			    conftest.c 1>&5'
+   { (eval echo "$as_me:$LINENO: \"$ac_try\"") >&5
+   (eval $ac_try) 2>&5
+   ac_status=$?
+   echo "$as_me:$LINENO: \$? = $ac_status" >&5
+   (exit $ac_status); }; }
+ then
+   libc_cv_fno_unit_at_a_time=yes
+ else
+   libc_cv_fno_unit_at_a_time=no
+ fi
+ rm -f conftest*
+ fi
+ echo "$as_me:$LINENO: result: $libc_cv_fno_unit_at_a_time" >&5
+ echo "${ECHO_T}$libc_cv_fno_unit_at_a_time" >&6
+ if test $libc_cv_fno_unit_at_a_time = yes; then
+   fno_unit_at_a_time=-fno-unit-at-a-time
+ fi
+ 
+ 
  if test $elf != yes; then
    echo "$as_me:$LINENO: checking for .init and .fini sections" >&5
  echo $ECHO_N "checking for .init and .fini sections... $ECHO_C" >&6
*************** s,@ASFLAGS_config@,$ASFLAGS_config,;t t
*** 7834,7839 ****
--- 7863,7869 ----
  s,@libc_cv_z_combreloc@,$libc_cv_z_combreloc,;t t
  s,@libc_cv_z_execstack@,$libc_cv_z_execstack,;t t
  s,@libc_cv_fpie@,$libc_cv_fpie,;t t
+ s,@fno_unit_at_a_time@,$fno_unit_at_a_time,;t t
  s,@libc_cv_have_initfini@,$libc_cv_have_initfini,;t t
  s,@libc_cv_cpp_asm_debuginfo@,$libc_cv_cpp_asm_debuginfo,;t t
  s,@no_whole_archive@,$no_whole_archive,;t t
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/configure.in glibc-2.3.3/configure.in
*** glibc-2.3.3.orig/glibc-2.3.3/configure.in	2003-11-11 16:37:03.000000000 -0800
--- glibc-2.3.3/configure.in	2004-10-06 23:13:40.000000000 -0700
*************** EOF
*** 1372,1377 ****
--- 1372,1394 ----
    AC_SUBST(libc_cv_fpie)
  fi
  
+ AC_CACHE_CHECK(for -fno-unit-at-a-time, libc_cv_fno_unit_at_a_time, [dnl
+ cat > conftest.c <<EOF
+ int foo;
+ EOF
+ if AC_TRY_COMMAND([${CC-cc} $CFLAGS $CPPFLAGS -S -fno-unit-at-a-time
+ 			    conftest.c 1>&AS_MESSAGE_LOG_FD])
+ then
+   libc_cv_fno_unit_at_a_time=yes
+ else
+   libc_cv_fno_unit_at_a_time=no
+ fi
+ rm -f conftest*])
+ if test $libc_cv_fno_unit_at_a_time = yes; then
+   fno_unit_at_a_time=-fno-unit-at-a-time
+ fi
+ AC_SUBST(fno_unit_at_a_time)
+ 
  if test $elf != yes; then
    AC_CACHE_CHECK(for .init and .fini sections, libc_cv_have_initfini,
  		 [AC_TRY_COMPILE(, [asm (".section .init");
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/csu/Makefile glibc-2.3.3/csu/Makefile
*** glibc-2.3.3.orig/glibc-2.3.3/csu/Makefile	2003-09-25 13:29:39.000000000 -0700
--- glibc-2.3.3/csu/Makefile	2004-10-06 23:15:02.000000000 -0700
*************** omit-deps += $(crtstuff)
*** 104,110 ****
  $(crtstuff:%=$(objpfx)%.o): %.o: %.S $(objpfx)defs.h
  	$(compile.S) -g0 $(ASFLAGS-.os) -o $@
  
! CFLAGS-initfini.s = -g0 -fPIC -fno-inline-functions
  
  vpath initfini.c $(full_config_sysdirs)
  
--- 104,110 ----
  $(crtstuff:%=$(objpfx)%.o): %.o: %.S $(objpfx)defs.h
  	$(compile.S) -g0 $(ASFLAGS-.os) -o $@
  
! CFLAGS-initfini.s = -g0 -fPIC -fno-inline-functions $(fno-unit-at-a-time)
  
  vpath initfini.c $(full_config_sysdirs)
  
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/linuxthreads/Makefile glibc-2.3.3/linuxthreads/Makefile
*** glibc-2.3.3.orig/glibc-2.3.3/linuxthreads/Makefile	2003-10-02 11:48:48.000000000 -0700
--- glibc-2.3.3/linuxthreads/Makefile	2004-10-06 23:16:39.000000000 -0700
*************** endif
*** 101,107 ****
  extra-objs += $(crti-objs) $(crtn-objs)
  omit-deps += crti crtn
  
! CFLAGS-pt-initfini.s = -g0 -fPIC -fno-inline-functions
  endif
  
  librt-tests = ex10 ex11
--- 101,107 ----
  extra-objs += $(crti-objs) $(crtn-objs)
  omit-deps += crti crtn
  
! CFLAGS-pt-initfini.s = -g0 -fPIC -fno-inline-functions $(fno-unit-at-a-time)
  endif
  
  librt-tests = ex10 ex11
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/locale/Makefile glibc-2.3.3/locale/Makefile
*** glibc-2.3.3.orig/glibc-2.3.3/locale/Makefile	2003-06-13 13:42:48.000000000 -0700
--- glibc-2.3.3/locale/Makefile	2004-10-06 23:22:06.000000000 -0700
*************** locale-CPPFLAGS := -DLOCALE_PATH='$(loca
*** 100,105 ****
--- 100,106 ----
  CFLAGS-charmap.c = -Wno-write-strings -Wno-char-subscripts
  CFLAGS-locfile.c = -Wno-write-strings -Wno-char-subscripts
  CFLAGS-charmap-dir.c = -Wno-write-strings
+ CFLAGS-loadlocale.c = $(fno-unit-at-a-time)
  
  # This makes sure -DNOT_IN_libc is passed for all these modules.
  cpp-srcs-left := $(addsuffix .c,$(localedef-modules) $(localedef-aux) \
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/stdio-common/Makefile glibc-2.3.3/stdio-common/Makefile
*** glibc-2.3.3.orig/glibc-2.3.3/stdio-common/Makefile	2003-09-12 15:35:24.000000000 -0700
--- glibc-2.3.3/stdio-common/Makefile	2004-10-06 23:21:38.000000000 -0700
*************** CFLAGS-tempname.c = -fexceptions
*** 87,92 ****
--- 87,94 ----
  CFLAGS-psignal.c = -fexceptions
  CFLAGS-vprintf.c = -fexceptions
  CFLAGS-cuserid.c = -fexceptions
+ CFLAGS-errlist.c = $(fno-unit-at-a-time)
+ CFLAGS-siglist.c = $(fno-unit-at-a-time)
  
  tst-sscanf-ENV = LOCPATH=$(common-objpfx)localedata
  tst-swprintf-ENV = LOCPATH=$(common-objpfx)localedata
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/sysdeps/mips/atomicity.h glibc-2.3.3/sysdeps/mips/atomicity.h
*** glibc-2.3.3.orig/glibc-2.3.3/sysdeps/mips/atomicity.h	2003-03-13 21:30:31.000000000 -0800
--- glibc-2.3.3/sysdeps/mips/atomicity.h	2004-10-06 22:17:41.000000000 -0700
***************
*** 21,26 ****
--- 21,27 ----
  #define _MIPS_ATOMICITY_H    1
  
  #include <inttypes.h>
+ #include <sgidefs.h>
  
  static inline int
  __attribute__ ((unused))
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/sysdeps/mips/bits/setjmp.h glibc-2.3.3/sysdeps/mips/bits/setjmp.h
*** glibc-2.3.3.orig/glibc-2.3.3/sysdeps/mips/bits/setjmp.h	2003-03-20 14:29:44.000000000 -0800
--- glibc-2.3.3/sysdeps/mips/bits/setjmp.h	2004-10-06 22:15:04.000000000 -0700
***************
*** 22,27 ****
--- 22,28 ----
  # error "Never include <bits/setjmp.h> directly; use <setjmp.h> instead."
  #endif
  
+ #include <sgidefs.h>
  typedef struct
    {
  #if _MIPS_SIM == _MIPS_SIM_ABI32
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/sysdeps/mips/dl-machine.h glibc-2.3.3/sysdeps/mips/dl-machine.h
*** glibc-2.3.3.orig/glibc-2.3.3/sysdeps/mips/dl-machine.h	2003-07-30 23:33:52.000000000 -0700
--- glibc-2.3.3/sysdeps/mips/dl-machine.h	2004-10-07 14:08:18.000000000 -0700
*************** _dl_runtime_resolve:\n							      \
*** 473,480 ****
  	# Get the value of label '_dl_start_user' in t9 ($25).\n\
  	" STRINGXP(PTR_LA) " $25, _dl_start_user\n\
  	.globl _dl_start_user\n\
! 	.type _dl_start_user,@function\n\
! 	.ent _dl_start_user\n\
  _dl_start_user:\n\
  	" STRINGXP(SETUP_GP) "\n\
  	" STRINGXV(SETUP_GP64($18,_dl_start_user)) "\n\
--- 473,480 ----
  	# Get the value of label '_dl_start_user' in t9 ($25).\n\
  	" STRINGXP(PTR_LA) " $25, _dl_start_user\n\
  	.globl _dl_start_user\n\
!         .type _dl_start_user,@function\n\
!         .aent _dl_start_user\n\
  _dl_start_user:\n\
  	" STRINGXP(SETUP_GP) "\n\
  	" STRINGXV(SETUP_GP64($18,_dl_start_user)) "\n\
*************** _dl_start_user:\n\
*** 512,519 ****
  	" STRINGXP(PTR_LA) " $2, _dl_fini\n\
  	# Jump to the user entry point.\n\
  	move $25, $17\n\
! 	jr $25\n\
! 	.end _dl_start_user\n\t"\
  	_RTLD_EPILOGUE(ENTRY_POINT)\
  	".previous"\
  );
--- 512,518 ----
  	" STRINGXP(PTR_LA) " $2, _dl_fini\n\
  	# Jump to the user entry point.\n\
  	move $25, $17\n\
! 	jr $25\n\t"\
  	_RTLD_EPILOGUE(ENTRY_POINT)\
  	".previous"\
  );
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/sysdeps/mips/fpu/bits/mathdef.h glibc-2.3.3/sysdeps/mips/fpu/bits/mathdef.h
*** glibc-2.3.3.orig/glibc-2.3.3/sysdeps/mips/fpu/bits/mathdef.h	2003-03-14 07:30:43.000000000 -0800
--- glibc-2.3.3/sysdeps/mips/fpu/bits/mathdef.h	2004-10-06 22:31:12.000000000 -0700
***************
*** 17,22 ****
--- 17,24 ----
     Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
     02111-1307 USA.  */
  
+ #include <sgidefs.h>
+ 
  #if !defined _MATH_H && !defined _COMPLEX_H
  # error "Never use <bits/mathdef.h> directly; include <math.h> instead"
  #endif
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/sysdeps/mips/__longjmp.c glibc-2.3.3/sysdeps/mips/__longjmp.c
*** glibc-2.3.3.orig/glibc-2.3.3/sysdeps/mips/__longjmp.c	2001-07-05 21:56:00.000000000 -0700
--- glibc-2.3.3/sysdeps/mips/__longjmp.c	2004-09-24 15:51:06.000000000 -0700
*************** __longjmp (env, val_arg)
*** 37,42 ****
--- 37,43 ----
       along the way.  */
    register int val asm ("a1");
  
+ #ifndef __mips_soft_float
    /* Pull back the floating point callee-saved registers.  */
    asm volatile ("l.d $f20, %0" : : "m" (env[0].__fpregs[0]));
    asm volatile ("l.d $f22, %0" : : "m" (env[0].__fpregs[1]));
*************** __longjmp (env, val_arg)
*** 48,53 ****
--- 49,55 ----
    /* Get and reconstruct the floating point csr.  */
    asm volatile ("lw $2, %0" : : "m" (env[0].__fpc_csr));
    asm volatile ("ctc1 $2, $31");
+ #endif
  
    /* Get the GP. */
    asm volatile ("lw $gp, %0" : : "m" (env[0].__gp));
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/sysdeps/mips/machine-gmon.h glibc-2.3.3/sysdeps/mips/machine-gmon.h
*** glibc-2.3.3.orig/glibc-2.3.3/sysdeps/mips/machine-gmon.h	2003-03-17 07:53:37.000000000 -0800
--- glibc-2.3.3/sysdeps/mips/machine-gmon.h	2004-10-07 14:00:59.000000000 -0700
***************
*** 1,5 ****
  /* Machine-specific calling sequence for `mcount' profiling function.  MIPS
!    Copyright (C) 1996, 1997, 2000, 2001, 2002, 2003
  	Free Software Foundation, Inc.
     This file is part of the GNU C Library.
  
--- 1,5 ----
  /* Machine-specific calling sequence for `mcount' profiling function.  MIPS
!    Copyright (C) 1996, 1997, 2000, 2001, 2002, 2003, 2004
  	Free Software Foundation, Inc.
     This file is part of the GNU C Library.
  
***************
*** 18,23 ****
--- 18,25 ----
     Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
     02111-1307 USA.  */
  
+ #include <sgidefs.h>
+ 
  #define _MCOUNT_DECL(frompc,selfpc) \
  static void __attribute_used__ __mcount (u_long frompc, u_long selfpc)
  
*************** static void __attribute_used__ __mcount 
*** 81,90 ****
  # define CPRETURN
  #endif
  
! #if defined _ABIN32 && _MIPS_SIM == _ABIN32
  # define PTR_ADDU_STRING "add" /* no u */
  # define PTR_SUBU_STRING "sub" /* no u */
! #elif defined _ABI64 && _MIPS_SIM == _ABI64
  # define PTR_ADDU_STRING "daddu"
  # define PTR_SUBU_STRING "dsubu"
  #else
--- 83,92 ----
  # define CPRETURN
  #endif
  
! #if _MIPS_SIM == _MIPS_SIM_NABI32
  # define PTR_ADDU_STRING "add" /* no u */
  # define PTR_SUBU_STRING "sub" /* no u */
! #elif _MIPS_SIM == _MIPS_SIM_ABI64
  # define PTR_ADDU_STRING "daddu"
  # define PTR_SUBU_STRING "dsubu"
  #else
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/sysdeps/mips/setjmp_aux.c glibc-2.3.3/sysdeps/mips/setjmp_aux.c
*** glibc-2.3.3.orig/glibc-2.3.3/sysdeps/mips/setjmp_aux.c	2003-03-20 02:27:55.000000000 -0800
--- glibc-2.3.3/sysdeps/mips/setjmp_aux.c	2004-09-24 15:50:50.000000000 -0700
***************
*** 27,32 ****
--- 27,33 ----
  int
  __sigsetjmp_aux (jmp_buf env, int savemask, int sp, int fp)
  {
+ #ifndef __mips_soft_float
    /* Store the floating point callee-saved registers...  */
    asm volatile ("s.d $f20, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[0]));
    asm volatile ("s.d $f22, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[1]));
*************** __sigsetjmp_aux (jmp_buf env, int savema
*** 34,40 ****
    asm volatile ("s.d $f26, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[3]));
    asm volatile ("s.d $f28, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[4]));
    asm volatile ("s.d $f30, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[5]));
! 
    /* .. and the PC;  */
    asm volatile ("sw $31, %0" : : "m" (env[0].__jmpbuf[0].__pc));
  
--- 35,41 ----
    asm volatile ("s.d $f26, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[3]));
    asm volatile ("s.d $f28, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[4]));
    asm volatile ("s.d $f30, %0" : : "m" (env[0].__jmpbuf[0].__fpregs[5]));
! #endif
    /* .. and the PC;  */
    asm volatile ("sw $31, %0" : : "m" (env[0].__jmpbuf[0].__pc));
  
*************** __sigsetjmp_aux (jmp_buf env, int savema
*** 57,64 ****
--- 58,67 ----
    asm volatile ("sw $22, %0" : : "m" (env[0].__jmpbuf[0].__regs[6]));
    asm volatile ("sw $23, %0" : : "m" (env[0].__jmpbuf[0].__regs[7]));
  
+ #ifndef __mips_soft_float
    /* .. and finally get and reconstruct the floating point csr.  */
    asm ("cfc1 %0, $31" : "=r" (env[0].__jmpbuf[0].__fpc_csr));
+ #endif
  
    /* Save the signal mask if requested.  */
    return __sigjmp_save (env, savemask);
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/sysdeps/mips/sys/regdef.h glibc-2.3.3/sysdeps/mips/sys/regdef.h
*** glibc-2.3.3.orig/glibc-2.3.3/sysdeps/mips/sys/regdef.h	2003-04-08 19:51:04.000000000 -0700
--- glibc-2.3.3/sysdeps/mips/sys/regdef.h	2004-10-06 22:21:48.000000000 -0700
***************
*** 19,25 ****
  
  #ifndef _SYS_REGDEF_H
  #define _SYS_REGDEF_H
! 
  /*
   * Symbolic register names for 32 bit ABI
   */
--- 19,25 ----
  
  #ifndef _SYS_REGDEF_H
  #define _SYS_REGDEF_H
! #include <sgidefs.h>
  /*
   * Symbolic register names for 32 bit ABI
   */
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/sysdeps/mips/sys/ucontext.h glibc-2.3.3/sysdeps/mips/sys/ucontext.h
*** glibc-2.3.3.orig/glibc-2.3.3/sysdeps/mips/sys/ucontext.h	2003-03-17 07:47:12.000000000 -0800
--- glibc-2.3.3/sysdeps/mips/sys/ucontext.h	2004-10-06 22:22:33.000000000 -0700
***************
*** 23,29 ****
  
  #include <features.h>
  #include <signal.h>
! 
  /* Type for general register.  */
  #if _MIPS_SIM == _MIPS_SIM_ABI32
  typedef __uint32_t greg_t;
--- 23,29 ----
  
  #include <features.h>
  #include <signal.h>
! #include <sgidefs.h>
  /* Type for general register.  */
  #if _MIPS_SIM == _MIPS_SIM_ABI32
  typedef __uint32_t greg_t;
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/sysdeps/unix/sysv/linux/mips/bits/sigcontext.h glibc-2.3.3/sysdeps/unix/sysv/linux/mips/bits/sigcontext.h
*** glibc-2.3.3.orig/glibc-2.3.3/sysdeps/unix/sysv/linux/mips/bits/sigcontext.h	2003-04-13 04:36:32.000000000 -0700
--- glibc-2.3.3/sysdeps/unix/sysv/linux/mips/bits/sigcontext.h	2004-10-06 22:24:29.000000000 -0700
***************
*** 19,25 ****
  #if !defined _SIGNAL_H && !defined _SYS_UCONTEXT_H
  # error "Never use <bits/sigcontext.h> directly; include <signal.h> instead."
  #endif
! 
  #ifndef sigcontext_struct
  /* Kernel headers before 2.1.1 define a struct sigcontext_struct, but
     we need sigcontext.  */
--- 19,25 ----
  #if !defined _SIGNAL_H && !defined _SYS_UCONTEXT_H
  # error "Never use <bits/sigcontext.h> directly; include <signal.h> instead."
  #endif
! #include <sgidefs.h>
  #ifndef sigcontext_struct
  /* Kernel headers before 2.1.1 define a struct sigcontext_struct, but
     we need sigcontext.  */
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/sysdeps/unix/sysv/linux/mips/bits/stat.h glibc-2.3.3/sysdeps/unix/sysv/linux/mips/bits/stat.h
*** glibc-2.3.3.orig/glibc-2.3.3/sysdeps/unix/sysv/linux/mips/bits/stat.h	2003-04-05 11:57:35.000000000 -0800
--- glibc-2.3.3/sysdeps/unix/sysv/linux/mips/bits/stat.h	2004-10-06 22:25:40.000000000 -0700
***************
*** 33,39 ****
  #define _MKNOD_VER_SVR4		2
  #define _MKNOD_VER		_MKNOD_VER_LINUX /* The bits defined below.  */
  
! 
  #if _MIPS_SIM == _MIPS_SIM_ABI32
  /* Structure describing file characteristics.  */
  struct stat
--- 33,39 ----
  #define _MKNOD_VER_SVR4		2
  #define _MKNOD_VER		_MKNOD_VER_LINUX /* The bits defined below.  */
  
! #include <sgidefs.h>
  #if _MIPS_SIM == _MIPS_SIM_ABI32
  /* Structure describing file characteristics.  */
  struct stat
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/sysdeps/unix/sysv/linux/mips/kernel_stat.h glibc-2.3.3/sysdeps/unix/sysv/linux/mips/kernel_stat.h
*** glibc-2.3.3.orig/glibc-2.3.3/sysdeps/unix/sysv/linux/mips/kernel_stat.h	2003-04-05 11:57:35.000000000 -0800
--- glibc-2.3.3/sysdeps/unix/sysv/linux/mips/kernel_stat.h	2004-10-06 22:31:07.000000000 -0700
***************
*** 2,7 ****
--- 2,8 ----
     userland data structures are not identical, because of different
     padding.  */
  /* Definition of `struct stat' used in the kernel.  */
+ #include <sgidefs.h>
  #if _MIPS_SIM != _MIPS_SIM_ABI32
  struct kernel_stat
    {
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/sysdeps/unix/sysv/linux/mips/Makefile glibc-2.3.3/sysdeps/unix/sysv/linux/mips/Makefile
*** glibc-2.3.3.orig/glibc-2.3.3/sysdeps/unix/sysv/linux/mips/Makefile	2003-09-02 20:16:54.000000000 -0700
--- glibc-2.3.3/sysdeps/unix/sysv/linux/mips/Makefile	2004-09-25 23:46:51.000000000 -0700
*************** $(objpfx)syscall-%.h $(objpfx)syscall-%.
*** 26,32 ****
  	       -x c -I $(common-objdir) $(sysincludes) $< -D_LIBC -dM | \
  	 sed -n 's@^#define __NR_\([^ ]*\) .*$$@#define SYS_\1 __NR_\1@p' \
  	     > $(@:.d=.h).newt; \
! 	 if grep SYS_O32_ $(@:.d=.h).newt > /dev/null; then \
  	   echo '#if defined _ABI64 && _MIPS_SIM == _ABI64'; \
  	   sed -n 's/^\(#define SYS_\)N64_/\1/p' < $(@:.d=.h).newt; \
  	   echo '#elif defined _ABIN32 && _MIPS_SIM == _ABIN32'; \
--- 26,32 ----
  	       -x c -I $(common-objdir) $(sysincludes) $< -D_LIBC -dM | \
  	 sed -n 's@^#define __NR_\([^ ]*\) .*$$@#define SYS_\1 __NR_\1@p' \
  	     > $(@:.d=.h).newt; \
! 	 if flase && grep SYS_O32_ $(@:.d=.h).newt > /dev/null; then \
  	   echo '#if defined _ABI64 && _MIPS_SIM == _ABI64'; \
  	   sed -n 's/^\(#define SYS_\)N64_/\1/p' < $(@:.d=.h).newt; \
  	   echo '#elif defined _ABIN32 && _MIPS_SIM == _ABIN32'; \
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/sysdeps/unix/sysv/linux/mips/sigaction.c glibc-2.3.3/sysdeps/unix/sysv/linux/mips/sigaction.c
*** glibc-2.3.3.orig/glibc-2.3.3/sysdeps/unix/sysv/linux/mips/sigaction.c	2003-09-02 20:21:27.000000000 -0700
--- glibc-2.3.3/sysdeps/unix/sysv/linux/mips/sigaction.c	2004-10-06 22:30:52.000000000 -0700
***************
*** 24,29 ****
--- 24,30 ----
  #include <sys/syscall.h>
  
  #include "kernel-features.h"
+ #include <sgidefs.h>
  
  /* The difference here is that the sigaction structure used in the
     kernel is not the same as we use in the libc.  Therefore we must
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/sysdeps/unix/sysv/linux/mips/sigcontextinfo.h glibc-2.3.3/sysdeps/unix/sysv/linux/mips/sigcontextinfo.h
*** glibc-2.3.3.orig/glibc-2.3.3/sysdeps/unix/sysv/linux/mips/sigcontextinfo.h	2003-04-13 04:36:32.000000000 -0700
--- glibc-2.3.3/sysdeps/unix/sysv/linux/mips/sigcontextinfo.h	2004-10-06 22:30:37.000000000 -0700
***************
*** 17,22 ****
--- 17,23 ----
     Software Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA
     02111-1307 USA.  */
  
+ #include <sgidefs.h>
  
  #if _MIPS_SIM == _MIPS_SIM_ABI32
  
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/sysdeps/unix/sysv/linux/mips/sys/tas.h glibc-2.3.3/sysdeps/unix/sysv/linux/mips/sys/tas.h
*** glibc-2.3.3.orig/glibc-2.3.3/sysdeps/unix/sysv/linux/mips/sys/tas.h	2003-03-13 23:03:36.000000000 -0800
--- glibc-2.3.3/sysdeps/unix/sysv/linux/mips/sys/tas.h	2004-10-06 22:12:58.000000000 -0700
***************
*** 21,26 ****
--- 21,27 ----
  #define _SYS_TAS_H 1
  
  #include <features.h>
+ #include <sgidefs.h>
  
  __BEGIN_DECLS
  
diff -rcp glibc-2.3.3.orig/glibc-2.3.3/sysdeps/unix/sysv/linux/mips/sys/user.h glibc-2.3.3/sysdeps/unix/sysv/linux/mips/sys/user.h
*** glibc-2.3.3.orig/glibc-2.3.3/sysdeps/unix/sysv/linux/mips/sys/user.h	2003-04-13 04:36:32.000000000 -0700
--- glibc-2.3.3/sysdeps/unix/sysv/linux/mips/sys/user.h	2004-10-06 22:27:11.000000000 -0700
***************
*** 18,24 ****
  
  #ifndef _SYS_USER_H
  #define _SYS_USER_H	1
! 
  /* The whole purpose of this file is for GDB and GDB only.  Don't read
     too much into it.  Don't use it for anything other than GDB unless
     you know what you are doing.  */
--- 18,24 ----
  
  #ifndef _SYS_USER_H
  #define _SYS_USER_H	1
! #include <sgidefs.h>
  /* The whole purpose of this file is for GDB and GDB only.  Don't read
     too much into it.  Don't use it for anything other than GDB unless
     you know what you are doing.  */
