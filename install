#!/bin/bash

# care about existing files
function installdir() {
    local owner="$1"
    local moddir="$2"
    local modfile="$3"
    local directory="$4"

    mkdir -p "$directory"
    find $directory -exec chown "$owner" {} \;
    find $directory -type f -exec chmod "$modfile" {} \;
    find $directory -type d -exec chmod "$moddir" {} \;
}

post_install() {
    systemd-sysusers
    systemd-tmpfiles --create
    
    # template cache needs to be writeable
    installdir http:http 0700 0600 /var/lib/zarafa-postfixadmin

    # etc
    _etc=/etc/webapps/zarafa-postfixadmin
    installdir http:http 0700 0600 ${_etc}
    install --backup=simple --suffix .pacsave -o http -g http -m 0600  ${_etc}/config.local.php.example ${_etc}/config.local.php

    # fetchmail
    installdir fetchmail:fetchmail 0700 0600 /etc/mail/postfixadmin
    install --backup=simple --suffix .pacsave -o fetchmail -g fetchmail -m 0600  /etc/mail/postfixadmin/fetchmail.conf.example /etc/mail/postfixadmin/fetchmail.conf
}