From a9ce4fdc85392f1fdcee530d5121b5f89526fcf9 Mon Sep 17 00:00:00 2001
From: BarbUk <julien.virey@gmail.com>
Date: Sat, 24 Sep 2022 15:40:55 +0200
Subject: [PATCH 1/2] Add configurable user agent

---
 cmd/privatebin/main.go | 8 ++++++++
 privatebin.go          | 3 ++-
 2 files changed, 10 insertions(+), 1 deletion(-)

diff --git a/cmd/privatebin/main.go b/cmd/privatebin/main.go
index 7ce2201..7d0afe5 100644
--- a/cmd/privatebin/main.go
+++ b/cmd/privatebin/main.go
@@ -43,6 +43,7 @@ type BinCfg struct {
 	OpenDiscussion   *bool   `json:"open_discussion"`
 	BurnAfterReading *bool   `json:"burn_after_reading"`
 	Formatter        string  `json:"formatter"`
+	UserAgent        string   `json:"user_agent"`
 }
 
 type Cfg struct {
@@ -51,12 +52,14 @@ type Cfg struct {
 	OpenDiscussion   bool     `json:"open_discussion"`
 	BurnAfterReading bool     `json:"burn_after_reading"`
 	Formatter        string   `json:"formatter"`
+	UserAgent        string   `json:"user_agent"`
 }
 
 func DefaultCfg() *Cfg {
 	return &Cfg{
 		Expire:    "1day",
 		Formatter: "plaintext",
+		UserAgent: "Privatebin cli +https://github.com/gearnode/privatebin",
 	}
 }
 
@@ -108,6 +111,10 @@ func loadCfgFile(path string) (*Cfg, error) {
 			binCfg.Formatter = cfg.Formatter
 		}
 
+		if binCfg.UserAgent == "" {
+			binCfg.UserAgent = cfg.UserAgent
+		}
+
 		cfg.Bin[i] = binCfg
 	}
 
@@ -198,6 +205,7 @@ func main() {
 		strings.Join(data, "\n"),
 		binCfg.Expire,
 		binCfg.Formatter,
+		binCfg.UserAgent,
 		*binCfg.OpenDiscussion,
 		*binCfg.BurnAfterReading,
 		*password)
diff --git a/privatebin.go b/privatebin.go
index 2e9cd0e..83fb886 100644
--- a/privatebin.go
+++ b/privatebin.go
@@ -100,7 +100,7 @@ type PasteContent struct {
 }
 
 func (c *Client) CreatePaste(
-	message, expire, formatter string,
+	message, expire, formatter string, useragent string,
 	openDiscussion, burnAfterReading bool,
 	password string,
 ) (*CreatePasteResponse, error) {
@@ -141,6 +141,7 @@ func (c *Client) CreatePaste(
 		c.URL.String(),
 		bytes.NewBuffer(body))
 
+	req.Header.Set("User-Agent", useragent)
 	req.Header.Set("Content-Type",
 		"application/x-www-form-urlencoded")
 	req.Header.Set("Content-Length", strconv.Itoa(len(body)))

From 1c432deee70e9149dbe90a47a59669b04e865514 Mon Sep 17 00:00:00 2001
From: BarbUk <julien.virey@gmail.com>
Date: Sat, 24 Sep 2022 15:41:11 +0200
Subject: [PATCH 2/2] Add user agent documentation

---
 doc/privatebin.conf.5.md | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/doc/privatebin.conf.5.md b/doc/privatebin.conf.5.md
index bc80ad6..0ad3996 100644
--- a/doc/privatebin.conf.5.md
+++ b/doc/privatebin.conf.5.md
@@ -23,6 +23,9 @@ instance configured in the **config.json**.
 **formatter** *string* (default: "plaintext")
 : The default formatter for a paste.
 
+**user_agent** *string* (default: "privatebin cli +https://github.com/gearnode/privatebin")
+: The default user agent for a paste.
+
 **expire** *string* (default: "1day")
 : The default time to live for a paste.
 
@@ -51,6 +54,9 @@ instance configured in the **config.json**.
 **formatter** *string*
 : The formatter for the paste.
 
+**user_agent** *string*
+: The user agent for the paste.
+
 ## The auth object format:
 **username** *string*
 : The basic auth username.
