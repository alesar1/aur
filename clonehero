#!/bin/bash

# Create/locate local user folder for the game.
xdg_data_home="${XDG_DATA_HOME:-$HOME/.local/share}"
dir="$xdg_data_home/clonehero"

if ! mkdir -p "$dir"; then
	echo "Failed to create directory at Â´$dir'"
	exit 1
fi

if ! cd "$dir"; then
	echo "Failed to change to directory '$dir'"
	exit 1
fi

# We have to copy the required files to get the game to run in a local user
# directory. Symbolic linking leads to runtime errors, running with a different
# working directory than the binary doesn't work either.
for f in clonehero_Data clonehero UnityPlayer.so; do
	if ! cp -rf "/opt/clonehero/$f" "$dir/$f"; then
		echo "Failed to copy '$f' to '$dir/$f'"
		exit 1
	fi
done

# We won't touch neither the Custom/ nor Songs/ directories as those are
# probably best left to the user to populate (or link to another folder).

exec ./clonehero "$@"
