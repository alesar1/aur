diff --git a/Telegram/SourceFiles/core/launcher.cpp b/Telegram/SourceFiles/core/launcher.cpp
index 7768510a0..a832d023f 100644
--- a/Telegram/SourceFiles/core/launcher.cpp
+++ b/Telegram/SourceFiles/core/launcher.cpp
@@ -278,6 +278,13 @@ int Launcher::exec() {
 	Platform::start();
 	Ui::DisableCustomScaling();
 
+	// I don't know why path is not in QT_PLUGIN_PATH by default
+	QCoreApplication::addLibraryPath("/usr/lib/qt/plugins");
+	// without this Telegram doesn't start on Ubuntu 17.04 due GTK errors
+	setenv("QT_STYLE_OVERRIDE", "breeze", false);
+	// Telegram doesn't start when extraordinary theme is set, see launchpad.net/bugs/1680943
+	unsetenv("QT_QPA_PLATFORMTHEME");
+
 	auto result = executeApplication();
 
 	DEBUG_LOG(("Kotatogram finished, result: %1").arg(result));
diff --git a/Telegram/SourceFiles/qt_static_plugins.cpp b/Telegram/SourceFiles/qt_static_plugins.cpp
index cc1a767cf..c71c8e8af 100644
--- a/Telegram/SourceFiles/qt_static_plugins.cpp
+++ b/Telegram/SourceFiles/qt_static_plugins.cpp
@@ -19,14 +19,4 @@ Q_IMPORT_PLUGIN(QWindowsIntegrationPlugin)
 #elif defined Q_OS_MAC // Q_OS_WIN
 Q_IMPORT_PLUGIN(QCocoaIntegrationPlugin)
 Q_IMPORT_PLUGIN(QGenericEnginePlugin)
-#elif defined Q_OS_LINUX // Q_OS_WIN | Q_OS_MAC
-Q_IMPORT_PLUGIN(QXcbIntegrationPlugin)
-Q_IMPORT_PLUGIN(QConnmanEnginePlugin)
-Q_IMPORT_PLUGIN(QGenericEnginePlugin)
-Q_IMPORT_PLUGIN(QNetworkManagerEnginePlugin)
-Q_IMPORT_PLUGIN(QComposePlatformInputContextPlugin)
-Q_IMPORT_PLUGIN(QIbusPlatformInputContextPlugin)
-Q_IMPORT_PLUGIN(QFcitxPlatformInputContextPlugin)
-Q_IMPORT_PLUGIN(QHimePlatformInputContextPlugin)
-Q_IMPORT_PLUGIN(NimfInputContextPlugin)
-#endif // Q_OS_WIN | Q_OS_MAC | Q_OS_LINUX
+#endif // Q_OS_WIN | Q_OS_MAC
Submodule Telegram/gyp/helpers contains modified content
diff --git a/Telegram/gyp/helpers/PrecompiledHeader.cmake b/Telegram/gyp/helpers/PrecompiledHeader.cmake
index 9508bd8..15952e5 100644
--- a/Telegram/gyp/helpers/PrecompiledHeader.cmake
+++ b/Telegram/gyp/helpers/PrecompiledHeader.cmake
@@ -114,7 +114,7 @@ function(add_precompiled_header _target _input)
       set(_compiler_FLAGS "@${_pch_c_flags_file}")
       add_custom_command(
         OUTPUT "${_output_c}"
-        COMMAND "${CMAKE_C_COMPILER}" ${_compiler_FLAGS} -x c-header -o "${_output_c}" -c "${_pchfile}"
+        COMMAND "${CMAKE_C_COMPILER}" ${_compiler_FLAGS} "$(C_DEFINES)" "$(C_INCLUDES)" "$(C_FLAGS)" -x c-header -o "${_output_c}" -c "${_pchfile}"
         DEPENDS "${_pchfile}" "${_pch_c_flags_file}"
         IMPLICIT_DEPENDS C "${_pch_header}"
         COMMENT "Precompiling ${_name} for ${_target} (C)")
@@ -125,7 +125,7 @@ function(add_precompiled_header _target _input)
       set(_compiler_FLAGS "@${_pch_cpp_flags_file}")
       add_custom_command(
         OUTPUT "${_output_cxx}"
-        COMMAND "${CMAKE_CXX_COMPILER}" ${_compiler_FLAGS} -x c++-header -o "${_output_cxx}" -c "${_pchfile}"
+        COMMAND "${CMAKE_CXX_COMPILER}" ${_compiler_FLAGS} "$(CXX_DEFINES)" "$(CXX_INCLUDES)" "$(CXX_FLAGS)" -x c++-header -o "${_output_cxx}" -c "${_pchfile}"
         DEPENDS "${_pchfile}" "${_pch_cpp_flags_file}"
         IMPLICIT_DEPENDS CXX "${_pch_header}"
         COMMENT "Precompiling header ${_name} for ${_target} (C++)")
diff --git a/Telegram/gyp/helpers/common/linux.gypi b/Telegram/gyp/helpers/common/linux.gypi
index 12b91b0..507a6b9 100644
--- a/Telegram/gyp/helpers/common/linux.gypi
+++ b/Telegram/gyp/helpers/common/linux.gypi
@@ -11,7 +11,6 @@
         'linux_common_flags': [
           '-pipe',
           '-Wall',
-          '-Werror',
           '-W',
           '-fPIC',
           '-Wno-unused-variable',
@@ -87,7 +86,6 @@
       ],
       'defines': [
         '_REENTRANT',
-        'QT_STATICPLUGIN',
         'QT_PLUGIN',
       ],
       'cflags_c': [
diff --git a/Telegram/gyp/helpers/modules/openssl.gypi b/Telegram/gyp/helpers/modules/openssl.gypi
index 91f1a99..d01c463 100644
--- a/Telegram/gyp/helpers/modules/openssl.gypi
+++ b/Telegram/gyp/helpers/modules/openssl.gypi
@@ -56,10 +56,6 @@
           '<(libs_loc)/openssl/include',
         ],
       }]],
-    }], [ 'build_linux', {
-      'include_dirs': [
-        '/usr/local/desktop-app/openssl-1.1.1/include',
-      ],
     }],
   ],
 }
diff --git a/Telegram/gyp/helpers/modules/qt.gypi b/Telegram/gyp/helpers/modules/qt.gypi
index e329211..7c2b8b0 100644
--- a/Telegram/gyp/helpers/modules/qt.gypi
+++ b/Telegram/gyp/helpers/modules/qt.gypi
@@ -14,27 +14,17 @@
               [ 'build_osx', {
                 'qt_version%': '5.6.2',
               }, {
-                'qt_version%': '5.12.5',
+                'qt_version%': '<!(echo /usr/include/qt/QtCore/*/ | grep -Po "\d+\.\d+\.\d+")',
               }]
             ],
           },
           'qt_libs_5_12_5': [
-            'qwebp',
-            'qgif',
-            'qjpeg',
-            'Qt5PrintSupport',
-            'Qt5AccessibilitySupport',
-            'Qt5FontDatabaseSupport',
-            'Qt5EventDispatcherSupport',
-            'Qt5ThemeSupport',
             'Qt5Network',
             'Qt5Widgets',
             'Qt5Gui',
-            'qtharfbuzz',
-            'qtlibpng',
           ],
           'qt_version%': '<(qt_version)',
-          'linux_path_qt%': '/usr/local/desktop-app/Qt-<(qt_version)',
+          'linux_path_qt%': '/usr/lib/qt',
         },
         'qt_version%': '<(qt_version)',
         'qt_loc_unix': '<(linux_path_qt)',
@@ -87,32 +77,13 @@
             ],
           }],
           [ 'build_linux', {
-            'qt_lib_prefix': 'lib',
-            'qt_lib_debug_postfix': '.a',
-            'qt_lib_release_postfix': '.a',
+            'qt_lib_prefix': '',
+            'qt_lib_debug_postfix': '',
+            'qt_lib_release_postfix': '',
             'qt_libs': [
-              'qxcb',
-              'Qt5XcbQpa',
-              'Qt5LinuxAccessibilitySupport',
-              'Qt5ServiceSupport',
-              'Qt5EdidSupport',
-              'qconnmanbearer',
-              'qgenericbearer',
-              'qnmbearer',
               '<@(qt_libs_5_12_5)',
               'Qt5DBus',
               'Qt5Core',
-              'qtpcre2',
-              'SM',
-              'ICE',
-              'fontconfig',
-              'freetype',
-              'expat',
-              'z',
-              'xcb-shm',
-              'xcb-xfixes',
-              'xcb-render',
-              'xcb-static',
             ],
           }],
         ],
@@ -142,11 +113,6 @@
     # '<!@(python <(DEPTH)/list_sources.py [sources] <(qt_moc_list_sources_arg))'
     # where [sources] contains all your source files
     'qt_moc_list_sources_arg': '--moc-prefix SHARED_INTERMEDIATE_DIR/<(_target_name)/moc/moc_',
-
-    'linux_path_xkbcommon%': '/usr/local',
-    'linux_lib_ssl%': '/usr/local/desktop-app/openssl-1.1.1/lib/libssl.a',
-    'linux_lib_crypto%': '/usr/local/desktop-app/openssl-1.1.1/lib/libcrypto.a',
-    'linux_lib_icu%': 'libicutu.a libicui18n.a libicuuc.a libicudata.a',
   },
 
   'configurations': {
@@ -205,14 +171,14 @@
   },
 
   'include_dirs': [
-    '<(qt_loc)/include',
-    '<(qt_loc)/include/QtCore',
-    '<(qt_loc)/include/QtGui',
-    '<(qt_loc)/include/QtDBus',
-    '<(qt_loc)/include/QtCore/<(qt_version)',
-    '<(qt_loc)/include/QtGui/<(qt_version)',
-    '<(qt_loc)/include/QtCore/<(qt_version)/QtCore',
-    '<(qt_loc)/include/QtGui/<(qt_version)/QtGui',
+    '/usr/include/qt',
+    '/usr/include/qt/QtCore',
+    '/usr/include/qt/QtGui',
+    '/usr/include/qt/QtDBus',
+    '/usr/include/qt/QtCore/<(qt_version)',
+    '/usr/include/qt/QtGui/<(qt_version)',
+    '/usr/include/qt/QtCore/<(qt_version)/QtCore',
+    '/usr/include/qt/QtGui/<(qt_version)/QtGui',
   ],
   'library_dirs': [
     '<(qt_loc)/lib',
@@ -236,24 +202,12 @@
         '<(DEPTH)/helpers/platform/linux/linux_glibc_wraps.gyp:linux_glibc_wraps',
       ],
       'libraries': [
-        '-lcomposeplatforminputcontextplugin',
-        '-libusplatforminputcontextplugin',
-        '-lfcitxplatforminputcontextplugin',
-        '-lhimeplatforminputcontextplugin',
-        '-lnimfplatforminputcontextplugin',
         '<@(qt_libs_release)',
-        '<(linux_path_xkbcommon)/lib/libxkbcommon.a',
-        '<(linux_path_xkbcommon)/lib/libxkbcommon-x11.a',
         '<(PRODUCT_DIR)/obj.target/helpers/platform/linux/liblinux_glibc_wraps.a',
         #'<(linux_lib_ssl)', # added in lib_ton
         #'<(linux_lib_crypto)', # added in lib_ton
-        '<!@(python -c "for s in \'<(linux_lib_icu)\'.split(\' \'): print(s)")',
-        '-lxcb',
         '-lX11',
-        '-lX11-xcb',
-        '-ldbus-1',
         '-ldl',
-        '-lgthread-2.0',
         '-lglib-2.0',
         '-lpthread',
       ],
@@ -261,7 +215,6 @@
         '<(qt_loc)/mkspecs/linux-g++',
       ],
       'ldflags': [
-        '-static-libstdc++',
         '-pthread',
         '-rdynamic',
       ],
diff --git a/Telegram/gyp/helpers/modules/qt_moc.gypi b/Telegram/gyp/helpers/modules/qt_moc.gypi
index 33cc236..b47ff9e 100644
--- a/Telegram/gyp/helpers/modules/qt_moc.gypi
+++ b/Telegram/gyp/helpers/modules/qt_moc.gypi
@@ -15,7 +15,7 @@
       '<(SHARED_INTERMEDIATE_DIR)/<(_target_name)/moc/moc_<(RULE_INPUT_ROOT).cpp',
     ],
     'action': [
-      '<(qt_loc)/bin/moc<(exe_ext)',
+      '/usr/bin/moc',
 
       # Silence "Note: No relevant classes found. No output generated."
       '--no-notes',
diff --git a/Telegram/gyp/telegram/linux.gypi b/Telegram/gyp/telegram/linux.gypi
index ba6bc45e8..73af2b27d 100644
--- a/Telegram/gyp/telegram/linux.gypi
+++ b/Telegram/gyp/telegram/linux.gypi
@@ -19,9 +19,11 @@
         #'xkbcommon',
       ],
     },
+    'library_dirs': [
+      '/usr/lib',
+      '/usr/lib/openssl',
+    ],
     'libraries': [
-      '-Wl,-Bstatic',
-      '-lbreakpad_client',
       '-llzma',
       '-lopenal',
       '-lavformat',
@@ -29,19 +31,10 @@
       '-lswresample',
       '-lswscale',
       '-lavutil',
+      '-lminizip',
       '-lopus',
-      '-lva-x11',
-      '-lva-drm',
-      '-lva',
-      '-lvdpau',
-      '-ldrm',
       '-lz',
-      '-lXi',
-      '-lXext',
-      '-lXfixes',
-      '-lXrender',
-      '<(linux_lib_ssl)',
-      '<(linux_lib_crypto)',
+      '-lcrypto',
 #      '<!(pkg-config 2> /dev/null --libs <@(pkgconfig_libs))',
     ],
     'cflags_cc': [
@@ -53,7 +46,6 @@
       '-Wl,-wrap,secure_getenv',
       '-Wl,-wrap,clock_gettime',
       '-Wl,--no-as-needed,-lrt',
-      '-Wl,-Bstatic',
     ],
     'configurations': {
       'Release': {
@@ -77,9 +69,8 @@
         ],
       }], ['not_need_gtk!="True"', {
         'cflags_cc': [
-          '<!(pkg-config 2> /dev/null --cflags gtk+-2.0)',
-          '<!(pkg-config 2> /dev/null --cflags glib-2.0)',
-          '<!(pkg-config 2> /dev/null --cflags dee-1.0)',
+          '<!(pkg-config 2> /dev/null --cflags appindicator3-0.1)',
+          '<!(pkg-config 2> /dev/null --cflags gtk+-3.0)',
         ],
       }], ['<!(pkg-config ayatana-appindicator3-0.1; echo $?) == 0', {
         'cflags_cc': [ '<!(pkg-config --cflags ayatana-appindicator3-0.1)' ],
diff --git a/Telegram/gyp/telegram/sources.txt b/Telegram/gyp/telegram/sources.txt
index e3ccb66db..a55d5a5a0 100644
--- a/Telegram/gyp/telegram/sources.txt
+++ b/Telegram/gyp/telegram/sources.txt
@@ -842,15 +842,6 @@
 <(src_loc)/settings.cpp
 <(src_loc)/settings.h
 
-platforms: !win
-<(minizip_loc)/crypt.h
-<(minizip_loc)/ioapi.c
-<(minizip_loc)/ioapi.h
-<(minizip_loc)/zip.c
-<(minizip_loc)/zip.h
-<(minizip_loc)/unzip.c
-<(minizip_loc)/unzip.h
-
 platforms: win
 <(res_loc)/winrc/Telegram.rc
 
diff --git a/Telegram/gyp/tests/tests.gyp b/Telegram/gyp/tests/tests.gyp
index 43ae1d696..05fe0fbba 100644
--- a/Telegram/gyp/tests/tests.gyp
+++ b/Telegram/gyp/tests/tests.gyp
@@ -140,8 +140,7 @@
       ],
     }], [ 'build_linux', {
       'libraries': [
-        '<(linux_lib_ssl)',
-        '<(linux_lib_crypto)',
+        'crypto',
       ],
     }]],
   }],
diff --git a/Telegram/gyp/utils.gyp b/Telegram/gyp/utils.gyp
index 7d5dafaba..e250edb2b 100644
--- a/Telegram/gyp/utils.gyp
+++ b/Telegram/gyp/utils.gyp
@@ -73,8 +73,7 @@
       }],
       [ 'build_linux', {
         'libraries': [
-          '<(linux_lib_ssl)',
-          '<(linux_lib_crypto)',
+          'crypto',
           'lzma',
         ],
       }],
Submodule Telegram/lib_ui contains modified content
diff --git a/Telegram/lib_ui/gyp/qrc_rule.gypi b/Telegram/lib_ui/gyp/qrc_rule.gypi
index eb4654c..22419d2 100644
--- a/Telegram/lib_ui/gyp/qrc_rule.gypi
+++ b/Telegram/lib_ui/gyp/qrc_rule.gypi
@@ -60,7 +60,7 @@
       '<(SHARED_INTERMEDIATE_DIR)/<(_target_name)/qrc/qrc_<(RULE_INPUT_ROOT).cpp',
     ],
     'action': [
-      '<(qt_loc)/bin/rcc<(exe_ext)',
+      '/usr/bin/rcc',
       '-name', '<(RULE_INPUT_ROOT)',
       '-no-compress',
       '<(RULE_INPUT_PATH)',
diff --git a/Telegram/lib_ui/qt_conf/linux.qrc b/Telegram/lib_ui/qt_conf/linux.qrc
index b9f5692..990e7fa 100644
--- a/Telegram/lib_ui/qt_conf/linux.qrc
+++ b/Telegram/lib_ui/qt_conf/linux.qrc
@@ -1,6 +1,5 @@
 <RCC>
   <qresource prefix="/qt/etc">
-    <file alias="qt.conf">qt_linux.conf</file>
   </qresource>
   <qresource prefix="/fc">
     <file>fc-custom.conf</file>
