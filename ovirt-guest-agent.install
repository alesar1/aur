post_install() {
  /usr/bin/udevadm trigger --subsystem-match="virtio-ports" \
    --attr-match="name=com.redhat.rhevm.vdsm"
}

pre_remove() {
  /usr/bin/systemctl stop ovirt-guest-agent.service > /dev/null 2>&1
# Send an "uninstalled" notification to vdsm.
  VIRTIO=`grep "^device" /etc/ovirt-guest-agent.conf | awk '{ print $3; }'`
  if [ -w $VIRTIO ]
  then
  # Non blocking uninstalled notification
  echo -e '{"__name__": "uninstalled"}\n' | dd of=$VIRTIO \
  oflag=nonblock status=noxfer conv=nocreat 1>& /dev/null || :
  fi
}

post_remove() {
  /usr/bin/userdel ovirtagent > /dev/null
  /usr/bin/udevadm trigger --subsystem-match="virtio-ports" \
    --attr-match="name=com.redhat.rhevm.vdsm"
}

post_upgrade() {
    /usr/bin/systemctl try-restart ovirt-guest-agent.service >/dev/null 2>&1 || :
}
