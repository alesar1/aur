From 65b15ca1052bfb44fcede5c086eac97a3599482a Mon Sep 17 00:00:00 2001
From: Christoph Haag <christoph.haag@collabora.com>
Date: Mon, 30 Jul 2018 17:18:44 +0200
Subject: [PATCH] fix VREvent_Data_t union in c header and add pragma pack(
 push, 4)

---
 headers/openvr_capi.h | 51 ++++++++++++++++++++++++++++---------------
 1 file changed, 34 insertions(+), 17 deletions(-)

diff --git a/headers/openvr_capi.h b/headers/openvr_capi.h
index 1ee5a36..8052a33 100644
--- a/headers/openvr_capi.h
+++ b/headers/openvr_capi.h
@@ -1966,24 +1966,41 @@ typedef struct COpenVRContext
 	intptr_t m_pVRSpatialAnchors; // class vr::IVRSpatialAnchors *
 } COpenVRContext;
 
+ typedef union 
+ { 
+ 	VREvent_Reserved_t reserved; 
+ 	VREvent_Controller_t controller; 
+ 	VREvent_Mouse_t mouse; 
+ 	VREvent_Scroll_t scroll; 
+ 	VREvent_Process_t process; 
+ 	VREvent_Notification_t notification; 
+ 	VREvent_Overlay_t overlay; 
+ 	VREvent_Status_t status; 
+ 	VREvent_Keyboard_t keyboard; 
+ 	VREvent_Ipd_t ipd; 
+ 	VREvent_Chaperone_t chaperone; 
+ 	VREvent_PerformanceTest_t performanceTest; 
+ 	VREvent_TouchPadMove_t touchPadMove; 
+ 	VREvent_SeatedZeroPoseReset_t seatedZeroPoseReset; 
+ 	VREvent_Screenshot_t screenshot; 
+ 	VREvent_ScreenshotProgress_t screenshotProgress; 
+ 	VREvent_ApplicationLaunch_t applicationLaunch; 
+ 	VREvent_EditingCameraSurface_t cameraSurface; 
+ 	VREvent_MessageOverlay_t messageOverlay; 
+ 	VREvent_Property_t property; 
+ 	VREvent_DualAnalog_t dualAnalog; 
+ 	VREvent_HapticVibration_t hapticVibration; 
+ 	VREvent_WebConsole_t webConsole; 
+ 	VREvent_InputBindingLoad_t inputBinding; 
+ 	VREvent_InputActionManifestLoad_t actionManifest; 
+ 	VREvent_SpatialAnchor_t spatialAnchor; 
+} VREvent_Data_t; 
 
-typedef union
-{
-	VREvent_Reserved_t reserved;
-	VREvent_Controller_t controller;
-	VREvent_Mouse_t mouse;
-	VREvent_Scroll_t scroll;
-	VREvent_Process_t process;
-	VREvent_Notification_t notification;
-	VREvent_Overlay_t overlay;
-	VREvent_Status_t status;
-	VREvent_Keyboard_t keyboard;
-	VREvent_Ipd_t ipd;
-	VREvent_Chaperone_t chaperone;
-	VREvent_PerformanceTest_t performanceTest;
-	VREvent_TouchPadMove_t touchPadMove;
-	VREvent_SeatedZeroPoseReset_t seatedZeroPoseReset;
-} VREvent_Data_t;
+#if defined(__linux__) || defined(__APPLE__)
+// This structure was originally defined mis-packed on Linux, preserved for
+// compatibility.
+#pragma pack( push, 4 )
+#endif
 
 /** An event posted by the server to all running applications */
 struct VREvent_t
-- 
2.18.0

