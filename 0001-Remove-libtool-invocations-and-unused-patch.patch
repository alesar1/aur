From 4a43e4fbc430a8dc128f6897fa107d91952e90dc Mon Sep 17 00:00:00 2001
From: Martchus <martchus@gmx.net>
Date: Thu, 30 Aug 2018 18:23:59 +0200
Subject: [PATCH] Remove libtool invocations and unused patch

---
 .SRCINFO         |  4 +---
 PKGBUILD         | 10 +---------
 timing-fix.patch | 23 -----------------------
 3 files changed, 2 insertions(+), 35 deletions(-)
 delete mode 100644 timing-fix.patch

diff --git a/.SRCINFO b/.SRCINFO
index 397e6eb..8f0825c 100644
--- a/.SRCINFO
+++ b/.SRCINFO
@@ -1,9 +1,7 @@
-# Generated by mksrcinfo v8
-# Wed Feb 22 22:28:10 UTC 2017
 pkgbase = sphinxbase
 	pkgdesc = Common library for sphinx speech recognition.
 	pkgver = 5prealpha
-	pkgrel = 9
+	pkgrel = 10
 	url = http://cmusphinx.sourceforge.net/
 	arch = i686
 	arch = x86_64
diff --git a/PKGBUILD b/PKGBUILD
index 1525078..946bba5 100644
--- a/PKGBUILD
+++ b/PKGBUILD
@@ -5,7 +5,7 @@
 
 pkgname=sphinxbase
 pkgver=5prealpha
-pkgrel=9
+pkgrel=10
 pkgdesc='Common library for sphinx speech recognition.'
 url='http://cmusphinx.sourceforge.net/'
 arch=('i686' 'x86_64')
@@ -21,10 +21,6 @@ options=('!libtool')
 prepare() {
   cd "${pkgname}-${pkgver}"
 
-  #as release 6 seems the patch is no longer needed
-  #msg2 "Applying timing fix patch"
-  #patch -p1 < "$srcdir/timing-fix.patch"
-
   msg2 "Reconfiguring project for current version of Automake"
   autoreconf -ivf > /dev/null
 
@@ -61,8 +57,4 @@ package() {
   install -d "${pkgdir}/usr/share/licenses/${pkgname}"
   install -m644 "${srcdir}/${pkgname}-${pkgver}/LICENSE" \
                 "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
-
-  libtool --finish "${pkgdir}/usr/lib"
-  libtool --finish "${pkgdir}/usr/lib/python2.7/site-packages/sphinxbase"
-  libtool --finish "${pkgdir}/usr/lib/python3.6/site-packages/sphinxbase"
 }
diff --git a/timing-fix.patch b/timing-fix.patch
deleted file mode 100644
index 6c44e85..0000000
--- a/timing-fix.patch
+++ /dev/null
@@ -1,23 +0,0 @@
-commit a1d18a46aeec2022e64fa1b11b08b5721bc9f98f
-Author: Mladen Milinkovic <max@smoothware.net>
-Date:   Fri May 20 04:45:53 2016 +0200
-
-    fe_process_frames_ext() wasn't updating fe sample_counter in some cases
-    
-    When there wasn't enough samples in buffer to fill one frame,
-    sample_counter wasn't updated with samples that were stored in overflow
-    buffer.
-
-diff --git a/src/libsphinxbase/fe/fe_interface.c b/src/libsphinxbase/fe/fe_interface.c
-index 1cc3566..d090b6e 100644
---- a/src/libsphinxbase/fe/fe_interface.c
-+++ b/src/libsphinxbase/fe/fe_interface.c
-@@ -471,6 +471,8 @@ fe_process_frames_ext(fe_t *fe,
-             memcpy(fe->overflow_samps + fe->num_overflow_samps,
-                    *inout_spch, *inout_nsamps * (sizeof(int16)));
-             fe->num_overflow_samps += *inout_nsamps;
-+            /* Update global sample counter with number of samples */
-+            fe->sample_counter += *inout_nsamps;
-             /* Update input-output pointers and counters. */
-             *inout_spch += *inout_nsamps;
-             *inout_nsamps = 0;
-- 
2.18.0

