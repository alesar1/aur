#!/usr/bin/env node
const path = require("path");
const fs = require("fs");

const parseFile = function (path) {

    console.log("fix start")
    if (!fs.existsSync(path)) {
        return;
    }
    console.log("content")
    let content = JSON.parse(fs.readFileSync(path, "utf8"));

    content.name = "wechat_devtools";
    // 开启调试，更新参数
    content['chromium-args'] = content['chromium-args'].replace('--ignore-gpu-blacklist', '--ignore-gpu-blocklist') + ' --mixed-context'
    content.window.height = content.window.width = 1000
    fs.writeFileSync(path, JSON.stringify(content, null, 4));

};

const pkgDir = process.env['NW_PACKAGE_DIR']
parseFile(`${pkgDir}/package.json`);
parseFile(`${pkgDir}/package-lock.json`);
