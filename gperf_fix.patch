--- old/configure.ac	2017-05-27 11:18:05.530701701 +0200
+++ new/configure.ac	2017-05-27 11:19:55.640289171 +0200
@@ -20,6 +20,29 @@
 fi
 AC_SUBST(GPERF)
 
+GPERF_TEST="$(echo foo,bar | ${GPERF} -L ANSI-C)"
+
+AC_COMPILE_IFELSE(
+	[AC_LANG_PROGRAM([
+		#include <string.h>
+		const char * in_word_set(const char *, size_t);
+		$GPERF_TEST]
+	)],
+	[GPERF_LEN_TYPE=size_t],
+	[AC_COMPILE_IFELSE(
+		[AC_LANG_PROGRAM([
+			#include <string.h>
+			const char * in_word_set(const char *, unsigned);
+			$GPERF_TEST]
+		)],
+		[GPERF_LEN_TYPE=unsigned],
+		[AC_MSG_ERROR([** unable to determine gperf len type])]
+	)]
+)
+
+AC_DEFINE_UNQUOTED([GPERF_LEN_TYPE], [$GPERF_LEN_TYPE], [gperf len type])
+
+
 AC_CHECK_PROG(ANTLR, [antlr3], [antlr3])
 if test "x$ANTLR" = x; then
 	if test -d $srcdir/src/pregen; then
--- old/src/dmap_common.h.orig	2017-05-27 11:21:36.516858516 +0200
+++ new/src/dmap_common.h	2017-05-27 11:22:43.191258093 +0200
@@ -2,6 +2,7 @@
 #ifndef __DMAP_HELPERS_H__
 #define __DMAP_HELPERS_H__
 
+#include "config.h"
 #include <event2/buffer.h>
 #include <event2/http.h>
 
@@ -46,7 +47,7 @@
 
 /* From dmap_fields.gperf - keep in sync, don't alter */
 const struct dmap_field *
-dmap_find_field (register const char *str, register unsigned int len);
+dmap_find_field (register const char *str, register GPERF_LEN_TYPE len);
 
 
 void
